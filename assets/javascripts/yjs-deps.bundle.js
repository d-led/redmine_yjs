var YjsDeps=(()=>{var cs=Object.defineProperty,yo=Object.defineProperties;var bo=Object.getOwnPropertyDescriptors;var is=Object.getOwnPropertySymbols;var ko=Object.prototype.hasOwnProperty,So=Object.prototype.propertyIsEnumerable;var os=(e,t,n)=>t in e?cs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,W=(e,t)=>{for(var n in t||(t={}))ko.call(t,n)&&os(e,n,t[n]);if(is)for(var n of is(t))So.call(t,n)&&os(e,n,t[n]);return e},ue=(e,t)=>yo(e,bo(t));var xo=(e,t)=>{for(var n in t)cs(e,n,{get:t[n],enumerable:!0})};var _n={};xo(_n,{AbsolutePosition:()=>hn,AbstractConnector:()=>cr,AbstractStruct:()=>ie,AbstractType:()=>U,Array:()=>Nt,ContentAny:()=>xt,ContentBinary:()=>Pt,ContentDeleted:()=>oe,ContentDoc:()=>Ft,ContentEmbed:()=>ut,ContentFormat:()=>A,ContentJSON:()=>Ne,ContentString:()=>K,ContentType:()=>Y,Doc:()=>st,GC:()=>V,ID:()=>at,Item:()=>x,Map:()=>Mt,PermanentUserData:()=>ar,RelativePosition:()=>re,Skip:()=>I,Snapshot:()=>De,Text:()=>se,Transaction:()=>dn,UndoManager:()=>gr,UpdateDecoderV1:()=>j,UpdateDecoderV2:()=>R,UpdateEncoderV1:()=>it,UpdateEncoderV2:()=>$,XmlElement:()=>Bt,XmlFragment:()=>Rt,XmlHook:()=>Le,XmlText:()=>bn,YArrayEvent:()=>pn,YEvent:()=>Lt,YMapEvent:()=>mn,YTextEvent:()=>wn,YXmlEvent:()=>yn,applyUpdate:()=>xr,applyUpdateV2:()=>xn,cleanupYTextFormatting:()=>qi,compareIDs:()=>It,compareRelativePositions:()=>Fc,convertUpdateFormatV1ToV2:()=>cl,convertUpdateFormatV2ToV1:()=>Ii,createAbsolutePositionFromRelativePosition:()=>Pc,createDeleteSet:()=>Sn,createDeleteSetFromStructStore:()=>br,createDocFromSnapshot:()=>qc,createID:()=>w,createRelativePositionFromJSON:()=>vc,createRelativePositionFromTypeIndex:()=>Vc,createSnapshot:()=>Dr,decodeRelativePosition:()=>Rc,decodeSnapshot:()=>zc,decodeSnapshotV2:()=>mi,decodeStateVector:()=>Ur,decodeUpdate:()=>tl,decodeUpdateV2:()=>Ci,diffUpdate:()=>sl,diffUpdateV2:()=>Ir,emptySnapshot:()=>$c,encodeRelativePosition:()=>Nc,encodeSnapshot:()=>Hc,encodeSnapshotV2:()=>pi,encodeStateAsUpdate:()=>Cr,encodeStateAsUpdateV2:()=>di,encodeStateVector:()=>_r,encodeStateVectorFromUpdate:()=>el,encodeStateVectorFromUpdateV2:()=>Ai,equalDeleteSets:()=>hi,equalSnapshots:()=>jc,findIndexSS:()=>J,findRootTypeKey:()=>Er,getItem:()=>Tt,getItemCleanEnd:()=>dr,getItemCleanStart:()=>O,getState:()=>C,getTypeChildren:()=>ul,isDeleted:()=>jt,isParentOf:()=>Ee,iterateDeletedStructs:()=>vt,logType:()=>Ic,logUpdate:()=>Zc,logUpdateV2:()=>xi,mergeDeleteSets:()=>Ot,mergeUpdates:()=>Ui,mergeUpdatesV2:()=>Te,obfuscateUpdate:()=>il,obfuscateUpdateV2:()=>ol,parseUpdateMeta:()=>nl,parseUpdateMetaV2:()=>_i,readUpdate:()=>Ac,readUpdateV2:()=>Sr,relativePositionToJSON:()=>Tc,snapshot:()=>Gc,snapshotContainsUpdate:()=>Yc,transact:()=>S,tryGc:()=>Kc,typeListToArraySnapshot:()=>dl,typeMapGetAllSnapshot:()=>ji,typeMapGetSnapshot:()=>pl});var _=()=>new Map,Ge=e=>{let t=_();return e.forEach((n,r)=>{t.set(r,n)}),t},N=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},ls=(e,t)=>{let n=[];for(let[r,s]of e)n.push(t(s,r));return n},as=(e,t)=>{for(let[n,r]of e)if(t(r,n))return!0;return!1};var ct=()=>new Set;var qe=e=>e[e.length-1];var hs=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Q=Array.from;var us=(e,t)=>{for(let n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1};var ds=(e,t)=>{let n=new Array(e);for(let r=0;r<e;r++)n[r]=t(r,n);return n};var fe=Array.isArray;var zt=class{constructor(){this._observers=_()}on(t,n){return N(this._observers,t,ct).add(n),n}once(t,n){let r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){let r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Q((this._observers.get(t)||_()).values()).forEach(r=>r(...n))}destroy(){this._observers=_()}};var G=Math.floor;var $t=Math.abs;var Ye=(e,t)=>e<t?e:t,lt=(e,t)=>e>t?e:t,$a=Number.isNaN;var We=e=>e!==0?e<0:1/e<0;var Fn=Number.MAX_SAFE_INTEGER,Ga=Number.MIN_SAFE_INTEGER,qa=1<<31;var fs=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&G(e)===e),Ja=Number.isNaN,Ya=Number.parseInt;var Co=String.fromCharCode,Wa=String.fromCodePoint,Xa=Co(65535),Uo=e=>e.toLowerCase(),Ao=/^\s*/g,_o=e=>e.replace(Ao,""),Eo=/([A-Z])/g,jn=(e,t)=>_o(e.replace(Eo,n=>`${t}${Uo(n)}`));var Do=e=>{let t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},qt=typeof TextEncoder!="undefined"?new TextEncoder:null,Io=e=>qt.encode(e),ps=qt?Io:Do;var Gt=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Gt&&Gt.decode(new Uint8Array).length===1&&(Gt=null);var ms=(e,t)=>ds(t,()=>e).join("");var Ct=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},At=()=>new Ct;var To=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t};var z=e=>{let t=new Uint8Array(To(e)),n=0;for(let r=0;r<e.bufs.length;r++){let s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},vo=(e,t)=>{let n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(lt(n,t)*2),e.cpos=0)},E=(e,t)=>{let n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t};var Xt=E;var m=(e,t)=>{for(;t>127;)E(e,128|127&t),t=G(t/128);E(e,127&t)},pe=(e,t)=>{let n=We(t);for(n&&(t=-t),E(e,(t>63?128:0)|(n?64:0)|63&t),t=G(t/64);t>0;)E(e,(t>127?128:0)|127&t),t=G(t/128)},Hn=new Uint8Array(3e4),Oo=Hn.length/3,Vo=(e,t)=>{if(t.length<Oo){let n=qt.encodeInto(t,Hn).written||0;m(e,n);for(let r=0;r<n;r++)E(e,Hn[r])}else P(e,ps(t))},Lo=(e,t)=>{let n=unescape(encodeURIComponent(t)),r=n.length;m(e,r);for(let s=0;s<r;s++)E(e,n.codePointAt(s))},gt=qt&&qt.encodeInto?Vo:Lo;var Ss=(e,t)=>Kt(e,z(t)),Kt=(e,t)=>{let n=e.cbuf.length,r=e.cpos,s=Ye(n-r,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(lt(n*2,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},P=(e,t)=>{m(e,t.byteLength),Kt(e,t)},zn=(e,t)=>{vo(e,t);let n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},No=(e,t)=>zn(e,4).setFloat32(0,t,!1),Mo=(e,t)=>zn(e,8).setFloat64(0,t,!1),Ro=(e,t)=>zn(e,8).setBigInt64(0,t,!1);var ys=new DataView(new ArrayBuffer(4)),Bo=e=>(ys.setFloat32(0,e),ys.getFloat32(0)===e),Yt=(e,t)=>{switch(typeof t){case"string":E(e,119),gt(e,t);break;case"number":fs(t)&&$t(t)<=2147483647?(E(e,125),pe(e,t)):Bo(t)?(E(e,124),No(e,t)):(E(e,123),Mo(e,t));break;case"bigint":E(e,122),Ro(e,t);break;case"object":if(t===null)E(e,126);else if(fe(t)){E(e,117),m(e,t.length);for(let n=0;n<t.length;n++)Yt(e,t[n])}else if(t instanceof Uint8Array)E(e,116),P(e,t);else{E(e,118);let n=Object.keys(t);m(e,n.length);for(let r=0;r<n.length;r++){let s=n[r];gt(e,s),Yt(e,t[s])}}break;case"boolean":E(e,t?120:121);break;default:E(e,127)}},ge=class extends Ct{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&m(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}};var bs=e=>{e.count>0&&(pe(e.encoder,e.count===1?e.s:-e.s),e.count>1&&m(e.encoder,e.count-2))},Ut=class{constructor(){this.encoder=new Ct,this.s=0,this.count=0}write(t){this.s===t?this.count++:(bs(this),this.count=1,this.s=t)}toUint8Array(){return bs(this),z(this.encoder)}};var ks=e=>{if(e.count>0){let t=e.diff*2+(e.count===1?0:1);pe(e.encoder,t),e.count>1&&m(e.encoder,e.count-2)}},Wt=class{constructor(){this.encoder=new Ct,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(ks(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return ks(this),z(this.encoder)}},Qe=class{constructor(){this.sarr=[],this.s="",this.lensE=new Ut}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){let t=new Ct;return this.sarr.push(this.s),this.s="",gt(t,this.sarr.join("")),Kt(t,this.lensE.toUint8Array()),z(t)}};var Z=e=>new Error(e),X=()=>{throw Z("Method unimplemented")},M=()=>{throw Z("Unexpected case")};var Cs=Z("Unexpected end of array"),Us=Z("Integer out of Range"),Qt=class{constructor(t){this.arr=t,this.pos=0}},D=e=>new Qt(e),$n=e=>e.pos!==e.arr.length;var Fo=(e,t)=>{let n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},F=e=>Fo(e,y(e));var _t=e=>e.arr[e.pos++];var y=e=>{let t=0,n=1,r=e.arr.length;for(;e.pos<r;){let s=e.arr[e.pos++];if(t=t+(s&127)*n,n*=128,s<128)return t;if(t>Fn)throw Us}throw Cs},we=e=>{let t=e.arr[e.pos++],n=t&63,r=64,s=(t&64)>0?-1:1;if((t&128)===0)return s*n;let i=e.arr.length;for(;e.pos<i;){if(t=e.arr[e.pos++],n=n+(t&127)*r,r*=128,t<128)return s*n;if(n>Fn)throw Us}throw Cs};var jo=e=>{let t=y(e);if(t===0)return"";{let n=String.fromCodePoint(_t(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(_t(e));else for(;t>0;){let r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},Ho=e=>Gt.decode(F(e)),mt=Gt?Ho:jo;var Gn=(e,t)=>{let n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},zo=e=>Gn(e,4).getFloat32(0,!1),$o=e=>Gn(e,8).getFloat64(0,!1),Go=e=>Gn(e,8).getBigInt64(0,!1);var qo=[e=>{},e=>null,we,zo,$o,Go,e=>!1,e=>!0,mt,e=>{let t=y(e),n={};for(let r=0;r<t;r++){let s=mt(e);n[s]=Zt(e)}return n},e=>{let t=y(e),n=[];for(let r=0;r<t;r++)n.push(Zt(e));return n},F],Zt=e=>qo[127-_t(e)](e),me=class extends Qt{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),$n(this)?this.count=y(this)+1:this.count=-1),this.count--,this.s}};var Et=class extends Qt{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=we(this);let t=We(this.s);this.count=1,t&&(this.s=-this.s,this.count=y(this)+2)}return this.count--,this.s}};var te=class extends Qt{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let t=we(this),n=t&1;this.diff=G(t/2),this.count=1,n&&(this.count=y(this)+2)}return this.s+=this.diff,this.count--,this.s}},Ze=class{constructor(t){this.decoder=new Et(t),this.str=mt(this.decoder),this.spos=0}read(){let t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}};var Za=crypto.subtle,As=crypto.getRandomValues.bind(crypto);var qn=()=>As(new Uint32Array(1))[0];var Yo="10000000-1000-4000-8000"+-1e11,_s=()=>Yo.replace(/[018]/g,e=>(e^qn()&15>>e/4).toString(16));var tn=Date.now;var Jn=e=>new Promise(e);var nh=Promise.all.bind(Promise);var Yn=e=>e===void 0?null:e;var Wn=class{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}},Ds=new Wn,Qo=!0;try{typeof localStorage!="undefined"&&localStorage&&(Ds=localStorage,Qo=!1)}catch(e){}var Is=Ds;var vs=Object.assign,tc=Object.keys;var Os=(e,t)=>{for(let n in e)t(e[n],n)};var Ts=e=>tc(e).length;var Vs=e=>{for(let t in e)return!1;return!0},ec=(e,t)=>{for(let n in e)if(!t(e[n],n))return!1;return!0},nc=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Ls=(e,t)=>e===t||Ts(e)===Ts(t)&&ec(e,(n,r)=>(n!==void 0||nc(t,r))&&t[r]===n),rc=Object.freeze,Xn=e=>{for(let t in e){let n=e[t];(typeof n=="object"||typeof n=="function")&&Xn(e[t])}return rc(e)};var ye=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&ye(e,t,n+1)}};var Kn=e=>e;var Ns=(e,t)=>t.includes(e);var be=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var rh=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,tt,ic=[],oc=()=>{if(tt===void 0)if(be){tt=_();let e=process.argv,t=null;for(let n=0;n<e.length;n++){let r=e[n];r[0]==="-"?(t!==null&&tt.set(t,""),t=r):t!==null?(tt.set(t,r),t=null):ic.push(r)}t!==null&&tt.set(t,"")}else typeof location=="object"?(tt=_(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){let[t,n]=e.split("=");tt.set(`--${jn(t,"-")}`,n),tt.set(`-${jn(t,"-")}`,n)}})):tt=_();return tt},Qn=e=>oc().has(e);var ke=e=>be?Yn(process.env[e.toUpperCase().replaceAll("-","_")]):Yn(Is.getItem(e));var Rs=e=>Qn("--"+e)||ke(e)!==null,sh=Rs("production"),cc=be&&Ns(process.env.FORCE_COLOR,["true","1","2"]),Bs=cc||!Qn("--no-colors")&&!Rs("no-color")&&(!be||process.stdout.isTTY)&&(!be||Qn("--color")||ke("COLORTERM")!==null||(ke("TERM")||"").includes("color"));var lc=e=>new Uint8Array(e);var Fs=e=>{let t=lc(e.byteLength);return t.set(e),t};var Zn=class{constructor(t,n){this.left=t,this.right=n}},et=(e,t)=>new Zn(e,t);var Dt=typeof document!="undefined"?document:{};var ih=typeof DOMParser!="undefined"?new DOMParser:null;var js=e=>ls(e,(t,n)=>`${n}:${t};`).join("");var oh=Dt.ELEMENT_NODE,ch=Dt.TEXT_NODE,lh=Dt.CDATA_SECTION_NODE,ah=Dt.COMMENT_NODE,hh=Dt.DOCUMENT_NODE,uh=Dt.DOCUMENT_TYPE_NODE,dh=Dt.DOCUMENT_FRAGMENT_NODE;var nt=Symbol;var Se=nt(),xe=nt(),tr=nt(),er=nt(),nr=nt(),Ce=nt(),rr=nt(),ee=nt(),sr=nt(),Hs=e=>{var s;e.length===1&&((s=e[0])==null?void 0:s.constructor)===Function&&(e=e[0]());let t=[],n=[],r=0;for(;r<e.length;r++){let i=e[r];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)t.push(i);else if(i.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){let i=e[r];i instanceof Symbol||n.push(i)}return n};var fh=tn();var gc={[Se]:et("font-weight","bold"),[xe]:et("font-weight","normal"),[tr]:et("color","blue"),[nr]:et("color","green"),[er]:et("color","grey"),[Ce]:et("color","red"),[rr]:et("color","purple"),[ee]:et("color","orange"),[sr]:et("color","black")},pc=e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());let t=[],n=[],r=_(),s=[],i=0;for(;i<e.length;i++){let c=e[i],l=gc[c];if(l!==void 0)r.set(l.left,l.right);else{if(c===void 0)break;if(c.constructor===String||c.constructor===Number){let a=js(r);i>0||a.length>0?(t.push("%c"+c),n.push(a)):t.push(c)}else break}}for(i>0&&(s=n,s.unshift(t.join("")));i<e.length;i++){let c=e[i];c instanceof Symbol||s.push(c)}return s},zs=Bs?pc:Hs,en=(...e)=>{console.log(...zs(e)),$s.forEach(t=>t.print(e))},ir=(...e)=>{console.warn(...zs(e)),e.unshift(ee),$s.forEach(t=>t.print(e))};var $s=ct();var Gs=e=>({[Symbol.iterator](){return this},next:e}),qs=(e,t)=>Gs(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),nn=(e,t)=>Gs(()=>{let{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});var cr=class extends zt{constructor(t,n){super(),this.doc=t,this.awareness=n}},Ae=class{constructor(t,n){this.clock=t,this.len=n}},kt=class{constructor(){this.clients=new Map}},vt=(e,t,n)=>t.clients.forEach((r,s)=>{let i=e.doc.store.clients.get(s);if(i!=null){let o=i[i.length-1],c=o.id.clock+o.length;for(let l=0,a=r[l];l<r.length&&a.clock<c;a=r[++l])yi(e,i,a.clock,a.len,n)}}),kc=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){let s=G((n+r)/2),i=e[s],o=i.clock;if(o<=t){if(t<o+i.len)return s;n=s+1}else r=s-1}return null},jt=(e,t)=>{let n=e.clients.get(t.client);return n!==void 0&&kc(n,t.clock)!==null},yr=e=>{e.clients.forEach(t=>{t.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<t.length;n++){let s=t[r-1],i=t[n];s.clock+s.len>=i.clock?s.len=lt(s.len,i.clock+i.len-s.clock):(r<n&&(t[r]=i),r++)}t.length=r})},Ot=e=>{let t=new kt;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){let i=r.slice();for(let o=n+1;o<e.length;o++)hs(i,e[o].clients.get(s)||[]);t.clients.set(s,i)}});return yr(t),t},_e=(e,t,n,r)=>{N(e.clients,t,()=>[]).push(new Ae(n,r))},Sn=()=>new kt,br=e=>{let t=Sn();return e.clients.forEach((n,r)=>{let s=[];for(let i=0;i<n.length;i++){let o=n[i];if(o.deleted){let c=o.id.clock,l=o.length;if(i+1<n.length)for(let a=n[i+1];i+1<n.length&&a.deleted;a=n[++i+1])l+=a.length;s.push(new Ae(c,l))}}s.length>0&&t.clients.set(r,s)}),t},rt=(e,t)=>{m(e.restEncoder,t.clients.size),Q(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),m(e.restEncoder,n);let s=r.length;m(e.restEncoder,s);for(let i=0;i<s;i++){let o=r[i];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},ht=e=>{let t=new kt,n=y(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();let s=y(e.restDecoder),i=y(e.restDecoder);if(i>0){let o=N(t.clients,s,()=>[]);for(let c=0;c<i;c++)o.push(new Ae(e.readDsClock(),e.readDsLen()))}}return t},Ws=(e,t,n)=>{let r=new kt,s=y(e.restDecoder);for(let i=0;i<s;i++){e.resetDsCurVal();let o=y(e.restDecoder),c=y(e.restDecoder),l=n.clients.get(o)||[],a=C(n,o);for(let h=0;h<c;h++){let u=e.readDsClock(),d=u+e.readDsLen();if(u<a){a<d&&_e(r,o,a,d-a);let f=J(l,u),g=l[f];for(!g.deleted&&g.id.clock<u&&(l.splice(f+1,0,kn(t,g,u-g.id.clock)),f++);f<l.length&&(g=l[f++],g.id.clock<d);)g.deleted||(d<g.id.clock+g.length&&l.splice(f,0,kn(t,g,d-g.id.clock)),g.delete(t))}else _e(r,o,u,d-u)}}if(r.clients.size>0){let i=new $;return m(i.restEncoder,0),rt(i,r),i.toUint8Array()}return null},hi=(e,t)=>{if(e.clients.size!==t.clients.size)return!1;for(let[n,r]of e.clients.entries()){let s=t.clients.get(n);if(s===void 0||r.length!==s.length)return!1;for(let i=0;i<r.length;i++){let o=r[i],c=s[i];if(o.clock!==c.clock||o.len!==c.len)return!1}}return!0},ui=qn,st=class e extends zt{constructor({guid:t=_s(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:c=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=ui(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new un,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Jn(a=>{this.on("load",()=>{this.isLoaded=!0,a(this)})});let l=()=>Jn(a=>{let h=u=>{(u===void 0||u===!0)&&(this.off("sync",h),a())};this.on("sync",h)});this.on("sync",a=>{a===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=a===void 0||a===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let t=this._item;t!==null&&!this.shouldLoad&&S(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Q(this.subdocs).map(t=>t.guid))}transact(t,n=null){return S(this,t,n)}get(t,n=U){let r=N(this.share,t,()=>{let i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==U&&s!==n)if(s===U){let i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(t,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Nt)}getText(t=""){return this.get(t,se)}getMap(t=""){return this.get(t,Mt)}getXmlElement(t=""){return this.get(t,Bt)}getXmlFragment(t=""){return this.get(t,Rt)}toJSON(){let t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Q(this.subdocs).forEach(n=>n.destroy());let t=this._item;if(t!==null){this._item=null;let n=t.content;n.doc=new e(ue(W({guid:this.guid},n.opts),{shouldLoad:!1})),n.doc._item=t,S(t.parent.doc,r=>{let s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},Vt=class{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return y(this.restDecoder)}readDsLen(){return y(this.restDecoder)}},j=class extends Vt{readLeftID(){return w(y(this.restDecoder),y(this.restDecoder))}readRightID(){return w(y(this.restDecoder),y(this.restDecoder))}readClient(){return y(this.restDecoder)}readInfo(){return _t(this.restDecoder)}readString(){return mt(this.restDecoder)}readParentInfo(){return y(this.restDecoder)===1}readTypeRef(){return y(this.restDecoder)}readLen(){return y(this.restDecoder)}readAny(){return Zt(this.restDecoder)}readBuf(){return Fs(F(this.restDecoder))}readJSON(){return JSON.parse(mt(this.restDecoder))}readKey(){return mt(this.restDecoder)}},an=class{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=y(this.restDecoder),this.dsCurrVal}readDsLen(){let t=y(this.restDecoder)+1;return this.dsCurrVal+=t,t}},R=class extends an{constructor(t){super(t),this.keys=[],y(t),this.keyClockDecoder=new te(F(t)),this.clientDecoder=new Et(F(t)),this.leftClockDecoder=new te(F(t)),this.rightClockDecoder=new te(F(t)),this.infoDecoder=new me(F(t),_t),this.stringDecoder=new Ze(F(t)),this.parentInfoDecoder=new me(F(t),_t),this.typeRefDecoder=new Et(F(t)),this.lenDecoder=new Et(F(t))}readLeftID(){return new at(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new at(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Zt(this.restDecoder)}readBuf(){return F(this.restDecoder)}readJSON(){return Zt(this.restDecoder)}readKey(){let t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{let n=this.stringDecoder.read();return this.keys.push(n),n}}},St=class{constructor(){this.restEncoder=At()}toUint8Array(){return z(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){m(this.restEncoder,t)}writeDsLen(t){m(this.restEncoder,t)}},it=class extends St{writeLeftID(t){m(this.restEncoder,t.client),m(this.restEncoder,t.clock)}writeRightID(t){m(this.restEncoder,t.client),m(this.restEncoder,t.clock)}writeClient(t){m(this.restEncoder,t)}writeInfo(t){Xt(this.restEncoder,t)}writeString(t){gt(this.restEncoder,t)}writeParentInfo(t){m(this.restEncoder,t?1:0)}writeTypeRef(t){m(this.restEncoder,t)}writeLen(t){m(this.restEncoder,t)}writeAny(t){Yt(this.restEncoder,t)}writeBuf(t){P(this.restEncoder,t)}writeJSON(t){gt(this.restEncoder,JSON.stringify(t))}writeKey(t){gt(this.restEncoder,t)}},ne=class{constructor(){this.restEncoder=At(),this.dsCurrVal=0}toUint8Array(){return z(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){let n=t-this.dsCurrVal;this.dsCurrVal=t,m(this.restEncoder,n)}writeDsLen(t){t===0&&M(),m(this.restEncoder,t-1),this.dsCurrVal+=t}},$=class extends ne{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Wt,this.clientEncoder=new Ut,this.leftClockEncoder=new Wt,this.rightClockEncoder=new Wt,this.infoEncoder=new ge(Xt),this.stringEncoder=new Qe,this.parentInfoEncoder=new ge(Xt),this.typeRefEncoder=new Ut,this.lenEncoder=new Ut}toUint8Array(){let t=At();return m(t,0),P(t,this.keyClockEncoder.toUint8Array()),P(t,this.clientEncoder.toUint8Array()),P(t,this.leftClockEncoder.toUint8Array()),P(t,this.rightClockEncoder.toUint8Array()),P(t,z(this.infoEncoder)),P(t,this.stringEncoder.toUint8Array()),P(t,z(this.parentInfoEncoder)),P(t,this.typeRefEncoder.toUint8Array()),P(t,this.lenEncoder.toUint8Array()),Kt(t,z(this.restEncoder)),z(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Yt(this.restEncoder,t)}writeBuf(t){P(this.restEncoder,t)}writeJSON(t){Yt(this.restEncoder,t)}writeKey(t){let n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}},Sc=(e,t,n,r)=>{r=lt(r,t[0].id.clock);let s=J(t,r);m(e.restEncoder,t.length-s),e.writeClient(n),m(e.restEncoder,r);let i=t[s];i.write(e,r-i.id.clock);for(let o=s+1;o<t.length;o++)t[o].write(e,0)},kr=(e,t,n)=>{let r=new Map;n.forEach((s,i)=>{C(t,i)>s&&r.set(i,s)}),Me(t).forEach((s,i)=>{n.has(i)||r.set(i,0)}),m(e.restEncoder,r.size),Q(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{Sc(e,t.clients.get(s),s,i)})},xc=(e,t)=>{let n=_(),r=y(e.restDecoder);for(let s=0;s<r;s++){let i=y(e.restDecoder),o=new Array(i),c=e.readClient(),l=y(e.restDecoder);n.set(c,{i:0,refs:o});for(let a=0;a<i;a++){let h=e.readInfo();switch(31&h){case 0:{let u=e.readLen();o[a]=new V(w(c,l),u),l+=u;break}case 10:{let u=y(e.restDecoder);o[a]=new I(w(c,l),u),l+=u;break}default:{let u=(h&192)===0,d=new x(w(c,l),null,(h&128)===128?e.readLeftID():null,null,(h&64)===64?e.readRightID():null,u?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,u&&(h&32)===32?e.readString():null,Wi(e,h));o[a]=d,l+=d.length}}}}return n},Cc=(e,t,n)=>{let r=[],s=Q(n.keys()).sort((f,g)=>f-g);if(s.length===0)return null;let i=()=>{if(s.length===0)return null;let f=n.get(s[s.length-1]);for(;f.refs.length===f.i;)if(s.pop(),s.length>0)f=n.get(s[s.length-1]);else return null;return f},o=i();if(o===null)return null;let c=new un,l=new Map,a=(f,g)=>{let b=l.get(f);(b==null||b>g)&&l.set(f,g)},h=o.refs[o.i++],u=new Map,d=()=>{for(let f of r){let g=f.id.client,b=n.get(g);b?(b.i--,c.clients.set(g,b.refs.slice(b.i)),n.delete(g),b.i=0,b.refs=[]):c.clients.set(g,[f]),s=s.filter(p=>p!==g)}r.length=0};for(;;){if(h.constructor!==I){let g=N(u,h.id.client,()=>C(t,h.id.client))-h.id.clock;if(g<0)r.push(h),a(h.id.client,h.id.clock-1),d();else{let b=h.getMissing(e,t);if(b!==null){r.push(h);let p=n.get(b)||{refs:[],i:0};if(p.refs.length===p.i)a(b,C(t,b)),d();else{h=p.refs[p.i++];continue}}else(g===0||g<h.length)&&(h.integrate(e,g),u.set(h.id.client,h.id.clock+h.length))}}if(r.length>0)h=r.pop();else if(o!==null&&o.i<o.refs.length)h=o.refs[o.i++];else{if(o=i(),o===null)break;h=o.refs[o.i++]}}if(c.clients.size>0){let f=new $;return kr(f,c,new Map),m(f.restEncoder,0),{missing:l,update:f.toUint8Array()}}return null},Uc=(e,t)=>kr(e,t.doc.store,t.beforeState),Sr=(e,t,n,r=new R(e))=>S(t,s=>{s.local=!1;let i=!1,o=s.doc,c=o.store,l=xc(r,o),a=Cc(s,c,l),h=c.pendingStructs;if(h){for(let[d,f]of h.missing)if(f<C(c,d)){i=!0;break}if(a){for(let[d,f]of a.missing){let g=h.missing.get(d);(g==null||g>f)&&h.missing.set(d,f)}h.update=Te([h.update,a.update])}}else c.pendingStructs=a;let u=Ws(r,s,c);if(c.pendingDs){let d=new R(D(c.pendingDs));y(d.restDecoder);let f=Ws(d,s,c);u&&f?c.pendingDs=Te([u,f]):c.pendingDs=u||f}else c.pendingDs=u;if(i){let d=c.pendingStructs.update;c.pendingStructs=null,xn(s.doc,d)}},n,!1),Ac=(e,t,n)=>Sr(e,t,n,new j(e)),xn=(e,t,n,r=R)=>{let s=D(t);Sr(s,e,n,new r(s))},xr=(e,t,n)=>xn(e,t,n,j),_c=(e,t,n=new Map)=>{kr(e,t.store,n),rt(e,br(t.store))},di=(e,t=new Uint8Array([0]),n=new $)=>{let r=Ur(t);_c(n,e,r);let s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(Ir(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===it)return Ui(s.map((i,o)=>o===0?i:Ii(i)));if(n.constructor===$)return Te(s)}return s[0]},Cr=(e,t)=>di(e,t,new it),fi=e=>{let t=new Map,n=y(e.restDecoder);for(let r=0;r<n;r++){let s=y(e.restDecoder),i=y(e.restDecoder);t.set(s,i)}return t},Ur=e=>fi(new Vt(D(e))),Ar=(e,t)=>(m(e.restEncoder,t.size),Q(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{m(e.restEncoder,n),m(e.restEncoder,r)}),e),Ec=(e,t)=>Ar(e,Me(t.store)),Dc=(e,t=new ne)=>(e instanceof Map?Ar(t,e):Ec(t,e),t.toUint8Array()),_r=e=>Dc(e,new St),lr=class{constructor(){this.l=[]}},Xs=()=>new lr,Ks=(e,t)=>e.l.push(t),Qs=(e,t)=>{let n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},gi=(e,t,n)=>ye(e.l,[t,n]),at=class{constructor(t,n){this.client=t,this.clock=n}},It=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,w=(e,t)=>new at(e,t),Zs=(e,t)=>{m(e,t.client),m(e,t.clock)},ti=e=>w(y(e),y(e)),Er=e=>{for(let[t,n]of e.doc.share.entries())if(n===e)return t;throw M()},Ee=(e,t)=>{for(;t!==null;){if(t.parent===e)return!0;t=t.parent._item}return!1},Ic=e=>{let t=[],n=e._start;for(;n;)t.push(n),n=n.right;console.log("Children: ",t),console.log("Children content: ",t.filter(r=>!r.deleted).map(r=>r.content))},ar=class{constructor(t,n=t.getMap("users")){let r=new Map;this.yusers=n,this.doc=t,this.clients=new Map,this.dss=r;let s=(i,o)=>{let c=i.get("ds"),l=i.get("ids"),a=h=>this.clients.set(h,o);c.observe(h=>{h.changes.added.forEach(u=>{u.content.getContent().forEach(d=>{d instanceof Uint8Array&&this.dss.set(o,Ot([this.dss.get(o)||Sn(),ht(new Vt(D(d)))]))})})}),this.dss.set(o,Ot(c.map(h=>ht(new Vt(D(h)))))),l.observe(h=>h.changes.added.forEach(u=>u.content.getContent().forEach(a))),l.forEach(a)};n.observe(i=>{i.keysChanged.forEach(o=>s(n.get(o),o))}),n.forEach(s)}setUserMapping(t,n,r,{filter:s=()=>!0}={}){let i=this.yusers,o=i.get(r);o||(o=new Mt,o.set("ids",new Nt),o.set("ds",new Nt),i.set(r,o)),o.get("ids").push([n]),i.observe(c=>{setTimeout(()=>{let l=i.get(r);if(l!==o){o=l,this.clients.forEach((u,d)=>{r===u&&o.get("ids").push([d])});let a=new St,h=this.dss.get(r);h&&(rt(a,h),o.get("ds").push([a.toUint8Array()]))}},0)}),t.on("afterTransaction",c=>{setTimeout(()=>{let l=o.get("ds"),a=c.deleteSet;if(c.local&&a.clients.size>0&&s(c,a)){let h=new St;rt(h,a),l.push([h.toUint8Array()])}})})}getUserByClientId(t){return this.clients.get(t)||null}getUserByDeletedId(t){for(let[n,r]of this.dss.entries())if(jt(r,t))return n;return null}},re=class{constructor(t,n,r,s=0){this.type=t,this.tname=n,this.item=r,this.assoc=s}},Tc=e=>{let t={};return e.type&&(t.type=e.type),e.tname&&(t.tname=e.tname),e.item&&(t.item=e.item),e.assoc!=null&&(t.assoc=e.assoc),t},vc=e=>{var t;return new re(e.type==null?null:w(e.type.client,e.type.clock),(t=e.tname)!=null?t:null,e.item==null?null:w(e.item.client,e.item.clock),e.assoc==null?0:e.assoc)},hn=class{constructor(t,n,r=0){this.type=t,this.index=n,this.assoc=r}},Oc=(e,t,n=0)=>new hn(e,t,n),rn=(e,t,n)=>{let r=null,s=null;return e._item===null?s=Er(e):r=w(e._item.id.client,e._item.id.clock),new re(r,s,t,n)},Vc=(e,t,n=0)=>{let r=e._start;if(n<0){if(t===0)return rn(e,null,n);t--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>t)return rn(e,w(r.id.client,r.id.clock+t),n);t-=r.length}if(r.right===null&&n<0)return rn(e,r.lastId,n);r=r.right}return rn(e,null,n)},Lc=(e,t)=>{let{type:n,tname:r,item:s,assoc:i}=t;if(s!==null)m(e,0),Zs(e,s);else if(r!==null)Xt(e,1),gt(e,r);else if(n!==null)Xt(e,2),Zs(e,n);else throw M();return pe(e,i),e},Nc=e=>{let t=At();return Lc(t,e),z(t)},Mc=e=>{let t=null,n=null,r=null;switch(y(e)){case 0:r=ti(e);break;case 1:n=mt(e);break;case 2:t=ti(e)}let s=$n(e)?we(e):0;return new re(t,n,r,s)},Rc=e=>Mc(D(e)),Bc=(e,t)=>{let n=Tt(e,t),r=t.clock-n.id.clock;return{item:n,diff:r}},Pc=(e,t,n=!0)=>{let r=t.store,s=e.item,i=e.type,o=e.tname,c=e.assoc,l=null,a=0;if(s!==null){if(C(r,s.client)<=s.clock)return null;let h=n?mr(r,s):Bc(r,s),u=h.item;if(!(u instanceof x))return null;if(l=u.parent,l._item===null||!l._item.deleted){a=u.deleted||!u.countable?0:h.diff+(c>=0?0:1);let d=u.left;for(;d!==null;)!d.deleted&&d.countable&&(a+=d.length),d=d.left}}else{if(o!==null)l=t.get(o);else if(i!==null){if(C(r,i.client)<=i.clock)return null;let{item:h}=n?mr(r,i):{item:Tt(r,i)};if(h instanceof x&&h.content instanceof Y)l=h.content.type;else return null}else throw M();c>=0?a=l._length:a=0}return Oc(l,a,e.assoc)},Fc=(e,t)=>e===t||e!==null&&t!==null&&e.tname===t.tname&&It(e.item,t.item)&&It(e.type,t.type)&&e.assoc===t.assoc,De=class{constructor(t,n){this.ds=t,this.sv=n}},jc=(e,t)=>{let n=e.ds.clients,r=t.ds.clients,s=e.sv,i=t.sv;if(s.size!==i.size||n.size!==r.size)return!1;for(let[o,c]of s.entries())if(i.get(o)!==c)return!1;for(let[o,c]of n.entries()){let l=r.get(o)||[];if(c.length!==l.length)return!1;for(let a=0;a<c.length;a++){let h=c[a],u=l[a];if(h.clock!==u.clock||h.len!==u.len)return!1}}return!0},pi=(e,t=new ne)=>(rt(t,e.ds),Ar(t,e.sv),t.toUint8Array()),Hc=e=>pi(e,new St),mi=(e,t=new an(D(e)))=>new De(ht(t),fi(t)),zc=e=>mi(e,new Vt(D(e))),Dr=(e,t)=>new De(e,t),$c=Dr(Sn(),new Map),Gc=e=>Dr(br(e.store),Me(e.store)),wt=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!jt(t.ds,e.id),hr=(e,t)=>{let n=N(e.meta,hr,ct),r=e.doc.store;n.has(t)||(t.sv.forEach((s,i)=>{s<C(r,i)&&O(e,w(i,s))}),vt(e,t.ds,s=>{}),n.add(t))},qc=(e,t,n=new st)=>{if(e.gc)throw new Error("Garbage-collection must be disabled in `originDoc`!");let{sv:r,ds:s}=t,i=new $;return e.transact(o=>{let c=0;r.forEach(l=>{l>0&&c++}),m(i.restEncoder,c);for(let[l,a]of r){if(a===0)continue;a<C(e.store,l)&&O(o,w(l,a));let h=e.store.clients.get(l)||[],u=J(h,a-1);m(i.restEncoder,u+1),i.writeClient(l),m(i.restEncoder,0);for(let d=0;d<=u;d++)h[d].write(i,0)}rt(i,s)}),xn(n,i.toUint8Array(),"snapshot"),n},Jc=(e,t,n=R)=>{let r=new n(D(t)),s=new ot(r,!1);for(let o=s.curr;o!==null;o=s.next())if((e.sv.get(o.id.client)||0)<o.id.clock+o.length)return!1;let i=Ot([e.ds,ht(r)]);return hi(e.ds,i)},Yc=(e,t)=>Jc(e,t,j),un=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},Me=e=>{let t=new Map;return e.clients.forEach((n,r)=>{let s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},C=(e,t)=>{let n=e.clients.get(t);if(n===void 0)return 0;let r=n[n.length-1];return r.id.clock+r.length},wi=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{let r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw M()}n.push(t)},J=(e,t)=>{let n=0,r=e.length-1,s=e[r],i=s.id.clock;if(i===t)return r;let o=G(t/(i+s.length-1)*r);for(;n<=r;){if(s=e[o],i=s.id.clock,i<=t){if(t<i+s.length)return o;n=o+1}else r=o-1;o=G((n+r)/2)}throw M()},Wc=(e,t)=>{let n=e.clients.get(t.client);return n[J(n,t.clock)]},Tt=Wc,ur=(e,t,n)=>{let r=J(t,n),s=t[r];return s.id.clock<n&&s instanceof x?(t.splice(r+1,0,kn(e,s,n-s.id.clock)),r+1):r},O=(e,t)=>{let n=e.doc.store.clients.get(t.client);return n[ur(e,n,t.clock)]},dr=(e,t,n)=>{let r=t.clients.get(n.client),s=J(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==V&&r.splice(s+1,0,kn(e,i,n.clock-i.id.clock+1)),i},Xc=(e,t,n)=>{let r=e.clients.get(t.id.client);r[J(r,t.id.clock)]=n},yi=(e,t,n,r,s)=>{if(r===0)return;let i=n+r,o=ur(e,t,n),c;do c=t[o++],i<c.id.clock+c.length&&ur(e,t,i),s(c);while(o<t.length&&t[o].id.clock<i)},dn=class{constructor(t,n,r){this.doc=t,this.deleteSet=new kt,this.beforeState=Me(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},ei=(e,t)=>t.deleteSet.clients.size===0&&!as(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(yr(t.deleteSet),Uc(e,t),rt(e,t.deleteSet),!0),ni=(e,t,n)=>{let r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&N(e.changed,t,ct).add(n)},cn=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0;n=r,r=e[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof x&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}let i=t-s;return i&&e.splice(t+1-i,i),i},bi=(e,t,n)=>{for(let[r,s]of e.clients.entries()){let i=t.clients.get(r);for(let o=s.length-1;o>=0;o--){let c=s[o],l=c.clock+c.len;for(let a=J(i,c.clock),h=i[a];a<i.length&&h.id.clock<l;h=i[++a]){let u=i[a];if(c.clock+c.len<=u.id.clock)break;u instanceof x&&u.deleted&&!u.keep&&n(u)&&u.gc(t,!1)}}}},ki=(e,t)=>{e.clients.forEach((n,r)=>{let s=t.clients.get(r);for(let i=n.length-1;i>=0;i--){let o=n[i],c=Ye(s.length-1,1+J(s,o.clock+o.len-1));for(let l=c,a=s[l];l>0&&a.id.clock>=o.clock;a=s[l])l-=1+cn(s,l)}})},Kc=(e,t,n)=>{bi(e,t,n),ki(e,t)},Si=(e,t)=>{if(t<e.length){let n=e[t],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{yr(i),n.afterState=Me(n.doc.store),r.emit("beforeObserverCalls",[n,r]);let c=[];n.changed.forEach((l,a)=>c.push(()=>{(a._item===null||!a._item.deleted)&&a._callObserver(n,l)})),c.push(()=>{n.changedParentTypes.forEach((l,a)=>{a._dEH.l.length>0&&(a._item===null||!a._item.deleted)&&(l=l.filter(h=>h.target._item===null||!h.target._item.deleted),l.forEach(h=>{h.currentTarget=a,h._path=null}),l.sort((h,u)=>h.path.length-u.path.length),gi(a._dEH,l,n))})}),c.push(()=>r.emit("afterTransaction",[n,r])),ye(c,[]),n._needFormattingCleanup&&bl(n)}finally{r.gc&&bi(i,s,r.gcFilter),ki(i,s),n.afterState.forEach((h,u)=>{let d=n.beforeState.get(u)||0;if(d!==h){let f=s.clients.get(u),g=lt(J(f,d),1);for(let b=f.length-1;b>=g;)b-=1+cn(f,b)}});for(let h=o.length-1;h>=0;h--){let{client:u,clock:d}=o[h].id,f=s.clients.get(u),g=J(f,d);g+1<f.length&&cn(f,g+1)>1||g>0&&cn(f,g)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(en(ee,Se,"[yjs] ",xe,Ce,"Changed the client-id because another client seems to be using it."),r.clientID=ui()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){let h=new it;ei(h,n)&&r.emit("update",[h.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){let h=new $;ei(h,n)&&r.emit("updateV2",[h.toUint8Array(),n.origin,r,n])}let{subdocsAdded:c,subdocsLoaded:l,subdocsRemoved:a}=n;(c.size>0||a.size>0||l.size>0)&&(c.forEach(h=>{h.clientID=r.clientID,h.collectionid==null&&(h.collectionid=r.collectionid),r.subdocs.add(h)}),a.forEach(h=>r.subdocs.delete(h)),r.emit("subdocs",[{loaded:l,added:c,removed:a},r,n]),a.forEach(h=>h.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Si(e,t+1)}}},S=(e,t,n=null,r=!0)=>{let s=e._transactionCleanups,i=!1,o=null;e._transaction===null&&(i=!0,e._transaction=new dn(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(i){let c=e._transaction===s[0];e._transaction=null,c&&Si(s,0)}}return o},fr=class{constructor(t,n){this.insertions=n,this.deletions=t,this.meta=new Map}},ri=(e,t,n)=>{vt(e,n.deletions,r=>{r instanceof x&&t.scope.some(s=>s===e.doc||Ee(s,r))&&Lr(r,!1)})},si=(e,t,n)=>{let r=null,s=e.doc,i=e.scope;S(s,c=>{for(;t.length>0&&e.currStackItem===null;){let l=s.store,a=t.pop(),h=new Set,u=[],d=!1;vt(c,a.insertions,f=>{if(f instanceof x){if(f.redone!==null){let{item:g,diff:b}=mr(l,f.id);b>0&&(g=O(c,w(g.id.client,g.id.clock+b))),f=g}!f.deleted&&i.some(g=>g===c.doc||Ee(g,f))&&u.push(f)}}),vt(c,a.deletions,f=>{f instanceof x&&i.some(g=>g===c.doc||Ee(g,f))&&!jt(a.insertions,f.id)&&h.add(f)}),h.forEach(f=>{d=Yi(c,f,h,a.insertions,e.ignoreRemoteMapChanges,e)!==null||d});for(let f=u.length-1;f>=0;f--){let g=u[f];e.deleteFilter(g)&&(g.delete(c),d=!0)}e.currStackItem=d?a:null}c.changed.forEach((l,a)=>{l.has(null)&&a._searchMarker&&(a._searchMarker.length=0)}),r=c},e);let o=e.currStackItem;if(o!=null){let c=r.changedParentTypes;e.emit("stack-item-popped",[{stackItem:o,type:n,changedParentTypes:c,origin:e},e]),e.currStackItem=null}return o},gr=class extends zt{constructor(t,{captureTimeout:n=500,captureTransaction:r=l=>!0,deleteFilter:s=()=>!0,trackedOrigins:i=new Set([null]),ignoreRemoteMapChanges:o=!1,doc:c=fe(t)?t[0].doc:t instanceof st?t:t.doc}={}){super(),this.scope=[],this.doc=c,this.addToScope(t),this.deleteFilter=s,i.add(this),this.trackedOrigins=i,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=o,this.captureTimeout=n,this.afterTransactionHandler=l=>{if(!this.captureTransaction(l)||!this.scope.some(p=>l.changedParentTypes.has(p)||p===this.doc)||!this.trackedOrigins.has(l.origin)&&(!l.origin||!this.trackedOrigins.has(l.origin.constructor)))return;let a=this.undoing,h=this.redoing,u=a?this.redoStack:this.undoStack;a?this.stopCapturing():h||this.clear(!1,!0);let d=new kt;l.afterState.forEach((p,k)=>{let H=l.beforeState.get(k)||0,ss=p-H;ss>0&&_e(d,k,H,ss)});let f=tn(),g=!1;if(this.lastChange>0&&f-this.lastChange<this.captureTimeout&&u.length>0&&!a&&!h){let p=u[u.length-1];p.deletions=Ot([p.deletions,l.deleteSet]),p.insertions=Ot([p.insertions,d])}else u.push(new fr(l.deleteSet,d)),g=!0;!a&&!h&&(this.lastChange=f),vt(l,l.deleteSet,p=>{p instanceof x&&this.scope.some(k=>k===l.doc||Ee(k,p))&&Lr(p,!0)});let b=[{stackItem:u[u.length-1],origin:l.origin,type:a?"redo":"undo",changedParentTypes:l.changedParentTypes},this];g?this.emit("stack-item-added",b):this.emit("stack-item-updated",b)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){let n=new Set(this.scope);t=fe(t)?t:[t],t.forEach(r=>{n.has(r)||(n.add(r),(r instanceof U?r.doc!==this.doc:r!==this.doc)&&ir("[yjs#509] Not same Y.Doc"),this.scope.push(r))})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,n=!0){(t&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(r=>{t&&(this.undoStack.forEach(s=>ri(r,this,s)),this.undoStack=[]),n&&(this.redoStack.forEach(s=>ri(r,this,s)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=si(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=si(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}};function*Qc(e){let t=y(e.restDecoder);for(let n=0;n<t;n++){let r=y(e.restDecoder),s=e.readClient(),i=y(e.restDecoder);for(let o=0;o<r;o++){let c=e.readInfo();if(c===10){let l=y(e.restDecoder);yield new I(w(s,i),l),i+=l}else if((31&c)!==0){let l=(c&192)===0,a=new x(w(s,i),null,(c&128)===128?e.readLeftID():null,null,(c&64)===64?e.readRightID():null,l?e.readParentInfo()?e.readString():e.readLeftID():null,l&&(c&32)===32?e.readString():null,Wi(e,c));yield a,i+=a.length}else{let l=e.readLen();yield new V(w(s,i),l),i+=l}}}}var ot=class{constructor(t,n){this.gen=Qc(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===I);return this.curr}},Zc=e=>xi(e,j),xi=(e,t=R)=>{let n=[],r=new t(D(e)),s=new ot(r,!1);for(let o=s.curr;o!==null;o=s.next())n.push(o);en("Structs: ",n);let i=ht(r);en("DeleteSet: ",i)},tl=e=>Ci(e,j),Ci=(e,t=R)=>{let n=[],r=new t(D(e)),s=new ot(r,!1);for(let i=s.curr;i!==null;i=s.next())n.push(i);return{structs:n,ds:ht(r)}},Ie=class{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}},Ui=e=>Te(e,j,it),Ai=(e,t=ne,n=R)=>{let r=new t,s=new ot(new n(D(e)),!1),i=s.curr;if(i!==null){let o=0,c=i.id.client,l=i.id.clock!==0,a=l?0:i.id.clock+i.length;for(;i!==null;i=s.next())c!==i.id.client&&(a!==0&&(o++,m(r.restEncoder,c),m(r.restEncoder,a)),c=i.id.client,a=0,l=i.id.clock!==0),i.constructor===I&&(l=!0),l||(a=i.id.clock+i.length);a!==0&&(o++,m(r.restEncoder,c),m(r.restEncoder,a));let h=At();return m(h,o),Ss(h,r.restEncoder),r.restEncoder=h,r.toUint8Array()}else return m(r.restEncoder,0),r.toUint8Array()},el=e=>Ai(e,St,j),_i=(e,t=R)=>{let n=new Map,r=new Map,s=new ot(new t(D(e)),!1),i=s.curr;if(i!==null){let o=i.id.client,c=i.id.clock;for(n.set(o,c);i!==null;i=s.next())o!==i.id.client&&(r.set(o,c),n.set(i.id.client,i.id.clock),o=i.id.client),c=i.id.clock+i.length;r.set(o,c)}return{from:n,to:r}},nl=e=>_i(e,j),rl=(e,t)=>{if(e.constructor===V){let{client:n,clock:r}=e.id;return new V(w(n,r+t),e.length-t)}else if(e.constructor===I){let{client:n,clock:r}=e.id;return new I(w(n,r+t),e.length-t)}else{let n=e,{client:r,clock:s}=n.id;return new x(w(r,s+t),null,w(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Te=(e,t=R,n=$)=>{if(e.length===1)return e[0];let r=e.map(h=>new t(D(h))),s=r.map(h=>new ot(h,!0)),i=null,o=new n,c=new Ie(o);for(;s=s.filter(d=>d.curr!==null),s.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){let g=d.curr.id.clock-f.curr.id.clock;return g===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===I?1:-1:g}else return f.curr.id.client-d.curr.id.client}),s.length!==0;){let h=s[0],u=h.curr.id.client;if(i!==null){let d=h.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=i.struct.id.clock+i.struct.length&&d.id.client>=i.struct.id.client;)d=h.next(),f=!0;if(d===null||d.id.client!==u||f&&d.id.clock>i.struct.id.clock+i.struct.length)continue;if(u!==i.struct.id.client)yt(c,i.struct,i.offset),i={struct:d,offset:0},h.next();else if(i.struct.id.clock+i.struct.length<d.id.clock)if(i.struct.constructor===I)i.struct.length=d.id.clock+d.length-i.struct.id.clock;else{yt(c,i.struct,i.offset);let g=d.id.clock-i.struct.id.clock-i.struct.length;i={struct:new I(w(u,i.struct.id.clock+i.struct.length),g),offset:0}}else{let g=i.struct.id.clock+i.struct.length-d.id.clock;g>0&&(i.struct.constructor===I?i.struct.length-=g:d=rl(d,g)),i.struct.mergeWith(d)||(yt(c,i.struct,i.offset),i={struct:d,offset:0},h.next())}}else i={struct:h.curr,offset:0},h.next();for(let d=h.curr;d!==null&&d.id.client===u&&d.id.clock===i.struct.id.clock+i.struct.length&&d.constructor!==I;d=h.next())yt(c,i.struct,i.offset),i={struct:d,offset:0}}i!==null&&(yt(c,i.struct,i.offset),i=null),Tr(c);let l=r.map(h=>ht(h)),a=Ot(l);return rt(o,a),o.toUint8Array()},Ir=(e,t,n=R,r=$)=>{let s=Ur(t),i=new r,o=new Ie(i),c=new n(D(e)),l=new ot(c,!1);for(;l.curr;){let h=l.curr,u=h.id.client,d=s.get(u)||0;if(l.curr.constructor===I){l.next();continue}if(h.id.clock+h.length>d)for(yt(o,h,lt(d-h.id.clock,0)),l.next();l.curr&&l.curr.id.client===u;)yt(o,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===u&&l.curr.id.clock+l.curr.length<=d;)l.next()}Tr(o);let a=ht(c);return rt(i,a),i.toUint8Array()},sl=(e,t)=>Ir(e,t,j,it),Ei=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:z(e.encoder.restEncoder)}),e.encoder.restEncoder=At(),e.written=0)},yt=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Ei(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),m(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Tr=e=>{Ei(e);let t=e.encoder.restEncoder;m(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){let r=e.clientStructs[n];m(t,r.written),Kt(t,r.restEncoder)}},Cn=(e,t,n,r)=>{let s=new n(D(e)),i=new ot(s,!1),o=new r,c=new Ie(o);for(let a=i.curr;a!==null;a=i.next())yt(c,t(a),0);Tr(c);let l=ht(s);return rt(o,l),o.toUint8Array()},Di=({formatting:e=!0,subdocs:t=!0,yxml:n=!0}={})=>{let r=0,s=_(),i=_(),o=_(),c=_();return c.set(null,null),l=>{switch(l.constructor){case V:case I:return l;case x:{let a=l,h=a.content;switch(h.constructor){case oe:break;case Y:{if(n){let u=h.type;u instanceof Bt&&(u.nodeName=N(i,u.nodeName,()=>"node-"+r)),u instanceof Le&&(u.hookName=N(i,u.hookName,()=>"hook-"+r))}break}case xt:{let u=h;u.arr=u.arr.map(()=>r);break}case Pt:{let u=h;u.content=new Uint8Array([r]);break}case Ft:{let u=h;t&&(u.opts={},u.doc.guid=r+"");break}case ut:{let u=h;u.embed={};break}case A:{let u=h;e&&(u.key=N(o,u.key,()=>r+""),u.value=N(c,u.value,()=>({i:r})));break}case Ne:{let u=h;u.arr=u.arr.map(()=>r);break}case K:{let u=h;u.str=ms(r%10+"",u.str.length);break}default:M()}return a.parentSub&&(a.parentSub=N(s,a.parentSub,()=>r+"")),r++,l}default:M()}}},il=(e,t)=>Cn(e,Di(t),j,it),ol=(e,t)=>Cn(e,Di(t),R,$),cl=e=>Cn(e,Kn,j,$),Ii=e=>Cn(e,Kn,R,it),ii="You must not compute changes after the event-handler fired.",Lt=class{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=ll(this.currentTarget,this.target))}deletes(t){return jt(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Z(ii);let t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){let i=n._map.get(s),o,c;if(this.adds(i)){let l=i.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(i))if(l!==null&&this.deletes(l))o="delete",c=qe(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",c=qe(l.content.getContent())):(o="add",c=void 0)}else if(this.deletes(i))o="delete",c=qe(i.content.getContent());else return;t.set(s,{action:o,oldValue:c})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Z(ii);let n=this.target,r=ct(),s=ct(),i=[];if(t={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let c=null,l=()=>{c&&i.push(c)};for(let a=n._start;a!==null;a=a.right)a.deleted?this.deletes(a)&&!this.adds(a)&&((c===null||c.delete===void 0)&&(l(),c={delete:0}),c.delete+=a.length,s.add(a)):this.adds(a)?((c===null||c.insert===void 0)&&(l(),c={insert:[]}),c.insert=c.insert.concat(a.content.getContent()),r.add(a)):((c===null||c.retain===void 0)&&(l(),c={retain:0}),c.retain+=a.length);c!==null&&c.retain===void 0&&l()}this._changes=t}return t}},ll=(e,t)=>{let n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)!s.deleted&&s.countable&&(r+=s.length),s=s.right;n.unshift(r)}t=t._item.parent}return n},T=()=>{ir("Invalid access: Add Yjs type to a document before reading data.")},Ti=80,vr=0,pr=class{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=vr++}},al=e=>{e.timestamp=vr++},vi=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=vr++},hl=(e,t,n)=>{if(e.length>=Ti){let r=e.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return vi(r,t,n),r}else{let r=new pr(t,n);return e.push(r),r}},Un=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;let n=e._searchMarker.length===0?null:e._searchMarker.reduce((i,o)=>$t(t-i.index)<$t(t-o.index)?i:o),r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,al(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&$t(n.index-s)<r.parent.length/Ti?(vi(n,r,s),n):hl(e._searchMarker,r,s)},ve=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){let s=e[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){e.splice(r,1);continue}s.p=i,i.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=lt(t,s.index+n))}},ul=e=>{var r;(r=e.doc)!=null||T();let t=e._start,n=[];for(;t;)n.push(t),t=t.right;return n},An=(e,t,n)=>{let r=e,s=t.changedParentTypes;for(;N(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;gi(r._eH,n,t)},U=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Xs(),this._dEH=Xs(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw X()}clone(){throw X()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Ks(this._eH,t)}observeDeep(t){Ks(this._dEH,t)}unobserve(t){Qs(this._eH,t)}unobserveDeep(t){Qs(this._dEH,t)}toJSON(){}},Oi=(e,t,n)=>{var o;(o=e.doc)!=null||T(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t,s=[],i=e._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){let c=i.content.getContent();if(c.length<=t)t-=c.length;else{for(let l=t;l<c.length&&r>0;l++)s.push(c[l]),r--;t=0}}i=i.right}return s},Vi=e=>{var r;(r=e.doc)!=null||T();let t=[],n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){let s=n.content.getContent();for(let i=0;i<s.length;i++)t.push(s[i])}n=n.right}return t},dl=(e,t)=>{let n=[],r=e._start;for(;r!==null;){if(r.countable&&wt(r,t)){let s=r.content.getContent();for(let i=0;i<s.length;i++)n.push(s[i])}r=r.right}return n},Oe=(e,t)=>{var s;let n=0,r=e._start;for((s=e.doc)!=null||T();r!==null;){if(r.countable&&!r.deleted){let i=r.content.getContent();for(let o=0;o<i.length;o++)t(i[o],n++,e)}r=r.right}},Li=(e,t)=>{let n=[];return Oe(e,(r,s)=>{n.push(t(r,s,e))}),n},fl=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}let s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},Ni=(e,t)=>{var s;(s=e.doc)!=null||T();let n=Un(e,t),r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},fn=(e,t,n,r)=>{let s=n,i=e.doc,o=i.clientID,c=i.store,l=n===null?t._start:n.right,a=[],h=()=>{a.length>0&&(s=new x(w(o,C(c,o)),s,s&&s.lastId,l,l&&l.id,t,null,new xt(a)),s.integrate(e,0),a=[])};r.forEach(u=>{if(u===null)a.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:a.push(u);break;default:switch(h(),u.constructor){case Uint8Array:case ArrayBuffer:s=new x(w(o,C(c,o)),s,s&&s.lastId,l,l&&l.id,t,null,new Pt(new Uint8Array(u))),s.integrate(e,0);break;case st:s=new x(w(o,C(c,o)),s,s&&s.lastId,l,l&&l.id,t,null,new Ft(u)),s.integrate(e,0);break;default:if(u instanceof U)s=new x(w(o,C(c,o)),s,s&&s.lastId,l,l&&l.id,t,null,new Y(u)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),h()},Mi=()=>Z("Length exceeded!"),Ri=(e,t,n,r)=>{if(n>t._length)throw Mi();if(n===0)return t._searchMarker&&ve(t._searchMarker,n,r.length),fn(e,t,null,r);let s=n,i=Un(t,n),o=t._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&O(e,w(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&ve(t._searchMarker,s,r.length),fn(e,t,o,r)},gl=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return fn(e,t,s,n)},Bi=(e,t,n,r)=>{if(r===0)return;let s=n,i=r,o=Un(t,n),c=t._start;for(o!==null&&(c=o.p,n-=o.index);c!==null&&n>0;c=c.right)!c.deleted&&c.countable&&(n<c.length&&O(e,w(c.id.client,c.id.clock+n)),n-=c.length);for(;r>0&&c!==null;)c.deleted||(r<c.length&&O(e,w(c.id.client,c.id.clock+r)),c.delete(e),r-=c.length),c=c.right;if(r>0)throw Mi();t._searchMarker&&ve(t._searchMarker,s,-i+r)},gn=(e,t,n)=>{let r=t._map.get(n);r!==void 0&&r.delete(e)},Or=(e,t,n,r)=>{let s=t._map.get(n)||null,i=e.doc,o=i.clientID,c;if(r==null)c=new xt([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:c=new xt([r]);break;case Uint8Array:c=new Pt(r);break;case st:c=new Ft(r);break;default:if(r instanceof U)c=new Y(r);else throw new Error("Unexpected content type")}new x(w(o,C(i.store,o)),s,s&&s.lastId,null,null,t,n,c).integrate(e,0)},Vr=(e,t)=>{var r;(r=e.doc)!=null||T();let n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Pi=e=>{var n;let t={};return(n=e.doc)!=null||T(),e._map.forEach((r,s)=>{r.deleted||(t[s]=r.content.getContent()[r.length-1])}),t},Fi=(e,t)=>{var r;(r=e.doc)!=null||T();let n=e._map.get(t);return n!==void 0&&!n.deleted},pl=(e,t,n)=>{let r=e._map.get(t)||null;for(;r!==null&&(!n.sv.has(r.id.client)||r.id.clock>=(n.sv.get(r.id.client)||0));)r=r.left;return r!==null&&wt(r,n)?r.content.getContent()[r.length-1]:void 0},ji=(e,t)=>{let n={};return e._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!t.sv.has(i.id.client)||i.id.clock>=(t.sv.get(i.id.client)||0));)i=i.left;i!==null&&wt(i,t)&&(n[s]=i.content.getContent()[i.length-1])}),n},sn=e=>{var t;return(t=e.doc)!=null||T(),qs(e._map.entries(),n=>!n[1].deleted)},pn=class extends Lt{},Nt=class e extends U{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){let n=new e;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new e}clone(){let t=new e;return t.insert(0,this.toArray().map(n=>n instanceof U?n.clone():n)),t}get length(){var t;return(t=this.doc)!=null||T(),this._length}_callObserver(t,n){super._callObserver(t,n),An(this,t,new pn(this,t))}insert(t,n){this.doc!==null?S(this.doc,r=>{Ri(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?S(this.doc,n=>{gl(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?S(this.doc,r=>{Bi(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Ni(this,t)}toArray(){return Vi(this)}slice(t=0,n=this.length){return Oi(this,t,n)}toJSON(){return this.map(t=>t instanceof U?t.toJSON():t)}map(t){return Li(this,t)}forEach(t){Oe(this,t)}[Symbol.iterator](){return fl(this)}_write(t){t.writeTypeRef(Ml)}},ml=e=>new Nt,mn=class extends Lt{constructor(t,n,r){super(t,n),this.keysChanged=r}},Mt=class e extends U{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new e}clone(){let t=new e;return this.forEach((n,r)=>{t.set(r,n instanceof U?n.clone():n)}),t}_callObserver(t,n){An(this,t,new mn(this,t,n))}toJSON(){var n;(n=this.doc)!=null||T();let t={};return this._map.forEach((r,s)=>{if(!r.deleted){let i=r.content.getContent()[r.length-1];t[s]=i instanceof U?i.toJSON():i}}),t}get size(){return[...sn(this)].length}keys(){return nn(sn(this),t=>t[0])}values(){return nn(sn(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return nn(sn(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){var n;(n=this.doc)!=null||T(),this._map.forEach((r,s)=>{r.deleted||t(r.content.getContent()[r.length-1],s,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?S(this.doc,n=>{gn(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?S(this.doc,r=>{Or(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Vr(this,t)}has(t){return Fi(this,t)}clear(){this.doc!==null?S(this.doc,t=>{this.forEach(function(n,r,s){gn(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Rl)}},wl=e=>new Mt,bt=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Ls(e,t),Ve=class{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&M(),this.right.content.constructor){case A:this.right.deleted||ce(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},oi=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case A:t.right.deleted||ce(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&O(e,w(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},on=(e,t,n,r)=>{let s=new Map,i=r?Un(t,n):null;if(i){let o=new Ve(i.p.left,i.p,i.index,s);return oi(e,o,n-i.index)}else{let o=new Ve(null,t._start,0,s);return oi(e,o,n)}},Hi=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===A&&bt(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();let s=e.doc,i=s.clientID;r.forEach((o,c)=>{let l=n.left,a=n.right,h=new x(w(i,C(s.store,i)),l,l&&l.lastId,a,a&&a.id,t,null,new A(c,o));h.integrate(e,0),n.right=h,n.forward()})},ce=(e,t)=>{let{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},zi=(e,t)=>{var n;for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===A&&bt((n=t[e.right.content.key])!=null?n:null,e.right.content.value)))break;e.forward()}},$i=(e,t,n,r)=>{var c;let s=e.doc,i=s.clientID,o=new Map;for(let l in r){let a=r[l],h=(c=n.currentAttributes.get(l))!=null?c:null;if(!bt(h,a)){o.set(l,h);let{left:u,right:d}=n;n.right=new x(w(i,C(s.store,i)),u,u&&u.lastId,d,d&&d.id,t,null,new A(l,a)),n.right.integrate(e,0),n.forward()}}return o},or=(e,t,n,r,s)=>{n.currentAttributes.forEach((d,f)=>{s[f]===void 0&&(s[f]=null)});let i=e.doc,o=i.clientID;zi(n,s);let c=$i(e,t,n,s),l=r.constructor===String?new K(r):r instanceof U?new Y(r):new ut(r),{left:a,right:h,index:u}=n;t._searchMarker&&ve(t._searchMarker,n.index,l.getLength()),h=new x(w(o,C(i.store,o)),a,a&&a.lastId,h,h&&h.id,t,null,l),h.integrate(e,0),n.right=h,n.index=u,n.forward(),Hi(e,t,n,c)},ci=(e,t,n,r,s)=>{let i=e.doc,o=i.clientID;zi(n,s);let c=$i(e,t,n,s);t:for(;n.right!==null&&(r>0||c.size>0&&(n.right.deleted||n.right.content.constructor===A));){if(!n.right.deleted)switch(n.right.content.constructor){case A:{let{key:l,value:a}=n.right.content,h=s[l];if(h!==void 0){if(bt(h,a))c.delete(l);else{if(r===0)break t;c.set(l,a)}n.right.delete(e)}else n.currentAttributes.set(l,a);break}default:r<n.right.length&&O(e,w(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;n.right=new x(w(o,C(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new K(l)),n.right.integrate(e,0),n.forward()}Hi(e,t,n,c)},Gi=(e,t,n,r,s)=>{var a,h;let i=t,o=_();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===A){let u=i.content;o.set(u.key,u)}i=i.right}let c=0,l=!1;for(;t!==i;){if(n===t&&(l=!0),!t.deleted){let u=t.content;switch(u.constructor){case A:{let{key:d,value:f}=u,g=(a=r.get(d))!=null?a:null;(o.get(d)!==u||g===f)&&(t.delete(e),c++,!l&&((h=s.get(d))!=null?h:null)===f&&g!==f&&(g===null?s.delete(d):s.set(d,g))),!l&&!t.deleted&&ce(s,u);break}}}t=t.right}return c},yl=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;let n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===A){let r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},qi=e=>{let t=0;return S(e.doc,n=>{let r=e._start,s=e._start,i=_(),o=Ge(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case A:ce(o,s.content);break;default:t+=Gi(n,r,s,i,o),i=Ge(o),r=s;break}s=s.right}}),t},bl=e=>{let t=new Set,n=e.doc;for(let[r,s]of e.afterState.entries()){let i=e.beforeState.get(r)||0;s!==i&&yi(e,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===A&&o.constructor!==V&&t.add(o.parent)})}S(n,r=>{vt(e,e.deleteSet,s=>{if(s instanceof V||!s.parent._hasFormatting||t.has(s.parent))return;let i=s.parent;s.content.constructor===A?t.add(i):yl(r,s)});for(let s of t)qi(s)})},li=(e,t,n)=>{let r=n,s=Ge(t.currentAttributes),i=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Y:case ut:case K:n<t.right.length&&O(e,w(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}i&&Gi(e,i,t.right,s,t.currentAttributes);let o=(t.left||t.right).parent;return o._searchMarker&&ve(o._searchMarker,t.index,-r+n),t},wn=class extends Lt{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){let t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){let t=this.target.doc,n=[];S(t,r=>{var f,g,b;let s=new Map,i=new Map,o=this.target._start,c=null,l={},a="",h=0,u=0,d=()=>{if(c!==null){let p=null;switch(c){case"delete":u>0&&(p={delete:u}),u=0;break;case"insert":(typeof a=="object"||a.length>0)&&(p={insert:a},s.size>0&&(p.attributes={},s.forEach((k,H)=>{k!==null&&(p.attributes[H]=k)}))),a="";break;case"retain":h>0&&(p={retain:h},Vs(l)||(p.attributes=vs({},l))),h=0;break}p&&n.push(p),c=null}};for(;o!==null;){switch(o.content.constructor){case Y:case ut:this.adds(o)?this.deletes(o)||(d(),c="insert",a=o.content.getContent()[0],d()):this.deletes(o)?(c!=="delete"&&(d(),c="delete"),u+=1):o.deleted||(c!=="retain"&&(d(),c="retain"),h+=1);break;case K:this.adds(o)?this.deletes(o)||(c!=="insert"&&(d(),c="insert"),a+=o.content.str):this.deletes(o)?(c!=="delete"&&(d(),c="delete"),u+=o.length):o.deleted||(c!=="retain"&&(d(),c="retain"),h+=o.length);break;case A:{let{key:p,value:k}=o.content;if(this.adds(o)){if(!this.deletes(o)){let H=(f=s.get(p))!=null?f:null;bt(H,k)?k!==null&&o.delete(r):(c==="retain"&&d(),bt(k,(g=i.get(p))!=null?g:null)?delete l[p]:l[p]=k)}}else if(this.deletes(o)){i.set(p,k);let H=(b=s.get(p))!=null?b:null;bt(H,k)||(c==="retain"&&d(),l[p]=H)}else if(!o.deleted){i.set(p,k);let H=l[p];H!==void 0&&(bt(H,k)?H!==null&&o.delete(r):(c==="retain"&&d(),k===null?delete l[p]:l[p]=k))}o.deleted||(c==="insert"&&d(),ce(s,o.content));break}}o=o.right}for(d();n.length>0;){let p=n[n.length-1];if(p.retain!==void 0&&p.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}},se=class e extends U{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){var t;return(t=this.doc)!=null||T(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new e}clone(){let t=new e;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);let r=new wn(this,t,n);An(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){var r;(r=this.doc)!=null||T();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===K&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?S(this.doc,r=>{let s=new Ve(null,this._start,0,new Map);for(let i=0;i<t.length;i++){let o=t[i];if(o.insert!==void 0){let c=!n&&typeof o.insert=="string"&&i===t.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof c!="string"||c.length>0)&&or(r,this,s,c,o.attributes||{})}else o.retain!==void 0?ci(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&li(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){var u;(u=this.doc)!=null||T();let s=[],i=new Map,o=this.doc,c="",l=this._start;function a(){if(c.length>0){let d={},f=!1;i.forEach((b,p)=>{f=!0,d[p]=b});let g={insert:c};f&&(g.attributes=d),s.push(g),c=""}}let h=()=>{for(;l!==null;){if(wt(l,t)||n!==void 0&&wt(l,n))switch(l.content.constructor){case K:{let d=i.get("ychange");t!==void 0&&!wt(l,t)?(d===void 0||d.user!==l.id.client||d.type!=="removed")&&(a(),i.set("ychange",r?r("removed",l.id):{type:"removed"})):n!==void 0&&!wt(l,n)?(d===void 0||d.user!==l.id.client||d.type!=="added")&&(a(),i.set("ychange",r?r("added",l.id):{type:"added"})):d!==void 0&&(a(),i.delete("ychange")),c+=l.content.str;break}case Y:case ut:{a();let d={insert:l.content.getContent()[0]};if(i.size>0){let f={};d.attributes=f,i.forEach((g,b)=>{f[b]=g})}s.push(d);break}case A:wt(l,t)&&(a(),ce(i,l.content));break}l=l.right}a()};return t||n?S(o,d=>{t&&hr(d,t),n&&hr(d,n),h()},"cleanup"):h(),s}insert(t,n,r){if(n.length<=0)return;let s=this.doc;s!==null?S(s,i=>{let o=on(i,this,t,!r);r||(r={},o.currentAttributes.forEach((c,l)=>{r[l]=c})),or(i,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){let s=this.doc;s!==null?S(s,i=>{let o=on(i,this,t,!r);or(i,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;let r=this.doc;r!==null?S(r,s=>{li(s,on(s,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;let s=this.doc;s!==null?S(s,i=>{let o=on(i,this,t,!1);o.right!==null&&ci(i,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?S(this.doc,n=>{gn(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?S(this.doc,r=>{Or(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Vr(this,t)}getAttributes(){return Pi(this)}_write(t){t.writeTypeRef(Bl)}},kl=e=>new se,Ue=class{constructor(t,n=()=>!0){var r;this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,(r=t.doc)!=null||T()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Bt||n.constructor===Rt)&&n._start!==null)t=n._start;else for(;t!==null;){let r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}},Rt=class e extends U{constructor(){super(),this._prelimContent=[]}get firstChild(){let t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new e}clone(){let t=new e;return t.insert(0,this.toArray().map(n=>n instanceof U?n.clone():n)),t}get length(){var t;return(t=this.doc)!=null||T(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Ue(this,t)}querySelector(t){t=t.toUpperCase();let r=new Ue(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Q(new Ue(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){An(this,t,new yn(this,n,t))}toString(){return Li(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){let s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),Oe(this,i=>{s.insertBefore(i.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?S(this.doc,r=>{Ri(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)S(this.doc,r=>{let s=t&&t instanceof U?t._item:t;fn(r,this,s,n)});else{let r=this._prelimContent,s=t===null?0:r.findIndex(i=>i===t)+1;if(s===0&&t!==null)throw Z("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?S(this.doc,r=>{Bi(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Vi(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Ni(this,t)}slice(t=0,n=this.length){return Oi(this,t,n)}forEach(t){Oe(this,t)}_write(t){t.writeTypeRef(Fl)}},Sl=e=>new Rt,Bt=class e extends Rt{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){let t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){let t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new e(this.nodeName)}clone(){let t=new e(this.nodeName),n=this.getAttributes();return Os(n,(r,s)=>{typeof r=="string"&&t.setAttribute(s,r)}),t.insert(0,this.toArray().map(r=>r instanceof U?r.clone():r)),t}toString(){let t=this.getAttributes(),n=[],r=[];for(let c in t)r.push(c);r.sort();let s=r.length;for(let c=0;c<s;c++){let l=r[c];n.push(l+'="'+t[l]+'"')}let i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(t){this.doc!==null?S(this.doc,n=>{gn(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?S(this.doc,r=>{Or(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Vr(this,t)}hasAttribute(t){return Fi(this,t)}getAttributes(t){return t?ji(this,t):Pi(this)}toDOM(t=document,n={},r){let s=t.createElement(this.nodeName),i=this.getAttributes();for(let o in i){let c=i[o];typeof c=="string"&&s.setAttribute(o,c)}return Oe(this,o=>{s.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(Pl),t.writeKey(this.nodeName)}},xl=e=>new Bt(e.readKey()),yn=class extends Lt{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}},Le=class e extends Mt{constructor(t){super(),this.hookName=t}_copy(){return new e(this.hookName)}clone(){let t=new e(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){let s=n[this.hookName],i;return s!==void 0?i=s.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(jl),t.writeKey(this.hookName)}},Cl=e=>new Le(e.readKey()),bn=class e extends se{get nextSibling(){let t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){let t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new e}clone(){let t=new e;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){let s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{let n=[];for(let s in t.attributes){let i=[];for(let o in t.attributes[s])i.push({key:o,value:t.attributes[s][o]});i.sort((o,c)=>o.key<c.key?-1:1),n.push({nodeName:s,attrs:i})}n.sort((s,i)=>s.nodeName<i.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){let i=n[s];r+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){let c=i.attrs[o];r+=` ${c.key}="${c.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Hl)}},Ul=e=>new bn,ie=class{constructor(t,n){this.id=t,this.length=n}get deleted(){throw X()}mergeWith(t){return!1}write(t,n,r){throw X()}integrate(t,n){throw X()}},Al=0,V=class extends ie{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),wi(t.doc.store,this)}write(t,n){t.writeInfo(Al),t.writeLen(this.length-n)}getMissing(t,n){return null}},Pt=class e{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new e(this.content)}splice(t){throw X()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}},_l=e=>new Pt(e.readBuf()),oe=class e{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new e(this.len)}splice(t){let n=new e(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){_e(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}},El=e=>new oe(e.readLen()),Ji=(e,t)=>new st(ue(W({guid:e},t),{shouldLoad:t.shouldLoad||t.autoLoad||!1})),Ft=class e{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;let n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new e(Ji(this.doc.guid,this.opts))}splice(t){throw X()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}},Dl=e=>new Ft(Ji(e.readString(),e.readAny())),ut=class e{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new e(this.embed)}splice(t){throw X()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}},Il=e=>new ut(e.readJSON()),A=class e{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new e(this.key,this.value)}splice(t){throw X()}mergeWith(t){return!1}integrate(t,n){let r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}},Tl=e=>new A(e.readKey(),e.readJSON()),Ne=class e{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new e(this.arr)}splice(t){let n=new e(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){let r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){let i=this.arr[s];t.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}},vl=e=>{let t=e.readLen(),n=[];for(let r=0;r<t;r++){let s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new Ne(n)},Ol=ke("node_env")==="development",xt=class e{constructor(t){this.arr=t,Ol&&Xn(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new e(this.arr)}splice(t){let n=new e(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){let r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){let i=this.arr[s];t.writeAny(i)}}getRef(){return 8}},Vl=e=>{let t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new xt(n)},K=class e{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new e(this.str)}splice(t){let n=new e(this.str.slice(t));this.str=this.str.slice(0,t);let r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",n.str="\uFFFD"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}},Ll=e=>new K(e.readString()),Nl=[ml,wl,kl,xl,Sl,Cl,Ul],Ml=0,Rl=1,Bl=2,Pl=3,Fl=4,jl=5,Hl=6,Y=class e{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new e(this.type._copy())}splice(t){throw X()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}},zl=e=>new Y(Nl[e.readTypeRef()](e)),mr=(e,t)=>{let n=t,r=0,s;do r>0&&(n=w(n.client,n.clock+r)),s=Tt(e,n),r=n.clock-s.id.clock,n=s.redone;while(n!==null&&s instanceof x);return{item:s,diff:r}},Lr=(e,t)=>{for(;e!==null&&e.keep!==t;)e.keep=t,e=e.parent._item},kn=(e,t,n)=>{let{client:r,clock:s}=t.id,i=new x(w(r,s+n),t,w(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),t.redone!==null&&(i.redone=w(t.redone.client,t.redone.clock+n)),t.right=i,i.right!==null&&(i.right.left=i),e._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),t.length=n,i},ai=(e,t)=>us(e,n=>jt(n.deletions,t)),Yi=(e,t,n,r,s,i)=>{let o=e.doc,c=o.store,l=o.clientID,a=t.redone;if(a!==null)return O(e,a);let h=t.parent._item,u=null,d;if(h!==null&&h.deleted===!0){if(h.redone===null&&(!n.has(h)||Yi(e,h,n,r,s,i)===null))return null;for(;h.redone!==null;)h=O(e,h.redone)}let f=h===null?t.parent:h.content.type;if(t.parentSub===null){for(u=t.left,d=t;u!==null;){let k=u;for(;k!==null&&k.parent._item!==h;)k=k.redone===null?null:O(e,k.redone);if(k!==null&&k.parent._item===h){u=k;break}u=u.left}for(;d!==null;){let k=d;for(;k!==null&&k.parent._item!==h;)k=k.redone===null?null:O(e,k.redone);if(k!==null&&k.parent._item===h){d=k;break}d=d.right}}else if(d=null,t.right&&!s){for(u=t;u!==null&&u.right!==null&&(u.right.redone||jt(r,u.right.id)||ai(i.undoStack,u.right.id)||ai(i.redoStack,u.right.id));)for(u=u.right;u.redone;)u=O(e,u.redone);if(u&&u.right!==null)return null}else u=f._map.get(t.parentSub)||null;let g=C(c,l),b=w(l,g),p=new x(b,u,u&&u.lastId,d,d&&d.id,f,t.parentSub,t.content.copy());return t.redone=b,Lr(p,!0),p.integrate(e,0),p},x=class e extends ie{constructor(t,n,r,s,i,o,c,l){super(t,l.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=c,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(t){(this.info&8)>0!==t&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(t){this.keep!==t&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(t){this.deleted!==t&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=C(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=C(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===at&&this.id.client!==this.parent.client&&this.parent.clock>=C(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=dr(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=O(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===V||this.right&&this.right.constructor===V)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===e?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===e&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===at){let r=Tt(n,this.parent);r.constructor===V?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=dr(t,t.doc.store,w(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;let i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),It(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(It(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(Tt(t.doc.store,s.origin)))i.has(Tt(t.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),wi(t.doc.store,this),this.content.integrate(t,this),ni(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new V(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:w(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&It(t.origin,this.lastId)&&this.right===t&&It(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){let n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){let n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),_e(t.deleteSet,this.id.client,this.id.clock,this.length),ni(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw M();this.content.gc(t),n?Xc(t,this,new V(this.id,this.length)):this.content=new oe(this.length)}write(t,n){let r=n>0?w(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&31|(r===null?0:128)|(s===null?0:64)|(i===null?0:32);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){let c=this.parent;if(c._item!==void 0){let l=c._item;if(l===null){let a=Er(c);t.writeParentInfo(!0),t.writeString(a)}else t.writeParentInfo(!1),t.writeLeftID(l.id)}else c.constructor===String?(t.writeParentInfo(!0),t.writeString(c)):c.constructor===at?(t.writeParentInfo(!1),t.writeLeftID(c)):M();i!==null&&t.writeString(i)}this.content.write(t,n)}},Wi=(e,t)=>$l[t&31](e),$l=[()=>{M()},El,vl,_l,Ll,Il,Tl,zl,Vl,Dl,()=>{M()}],Gl=10,I=class extends ie{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){M()}write(t,n){t.writeInfo(Gl),m(t.restEncoder,this.length-n)}getMissing(t,n){return null}},Xi=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},Ki="__ $YJS$ __";Xi[Ki]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Xi[Ki]=!0;var ql=Math.floor,Jl=(e,t)=>e<t?e:t,Yl=(e,t)=>e>t?e:t,to=128,En=127,Wl=Number.MAX_SAFE_INTEGER,Xl=e=>{let t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},Be=typeof TextEncoder!="undefined"?new TextEncoder:null,Kl=e=>Be.encode(e),Ql=Be?Kl:Xl,Re=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Re&&Re.decode(new Uint8Array).length===1&&(Re=null);var Dn=(e,t)=>{let n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Tn=(e,t)=>{for(;t>En;)Dn(e,to|En&t),t=ql(t/128);Dn(e,En&t)},Nr=new Uint8Array(3e4),Zl=Nr.length/3,ta=(e,t)=>{if(t.length<Zl){let n=Be.encodeInto(t,Nr).written||0;Tn(e,n);for(let r=0;r<n;r++)Dn(e,Nr[r])}else sa(e,Ql(t))},ea=(e,t)=>{let n=unescape(encodeURIComponent(t)),r=n.length;Tn(e,r);for(let s=0;s<r;s++)Dn(e,n.codePointAt(s))},na=Be&&Be.encodeInto?ta:ea,ra=(e,t)=>{let n=e.cbuf.length,r=e.cpos,s=Jl(n-r,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Yl(n*2,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},sa=(e,t)=>{Tn(e,t.byteLength),ra(e,t)},eo=e=>new Error(e),ia=eo("Unexpected end of array"),oa=eo("Integer out of Range"),ca=(e,t)=>{let n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},la=e=>ca(e,Mr(e)),Qi=e=>e.arr[e.pos++],Mr=e=>{let t=0,n=1,r=e.arr.length;for(;e.pos<r;){let s=e.arr[e.pos++];if(t=t+(s&En)*n,n*=128,s<to)return t;if(t>Wl)throw oa}throw ia},aa=e=>{let t=Mr(e);if(t===0)return"";{let n=String.fromCodePoint(Qi(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Qi(e));else for(;t>0;){let r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},ha=e=>Re.decode(la(e)),Zi=Re?ha:aa,le;(function(e){e[e.Token=0]="Token",e[e.PermissionDenied=1]="PermissionDenied",e[e.Authenticated=2]="Authenticated"})(le||(le={}));var no=(e,t)=>{Tn(e,le.Token),na(e,t)};var ro=(e,t,n,r)=>{switch(Mr(e)){case le.Token:{t();break}case le.PermissionDenied:{n(Zi(e));break}case le.Authenticated:{r(Zi(e));break}}};var Rr=e=>Array.from(e.entries()).map(([t,n])=>W({clientId:t},n)),In;(function(e){e[e.Connecting=0]="Connecting",e[e.Open=1]="Open",e[e.Closing=2]="Closing",e[e.Closed=3]="Closed"})(In||(In={}));function ua(e){return e||(e={}),{delay:e.delay===void 0?200:e.delay,initialDelay:e.initialDelay===void 0?0:e.initialDelay,minDelay:e.minDelay===void 0?0:e.minDelay,maxDelay:e.maxDelay===void 0?0:e.maxDelay,factor:e.factor===void 0?0:e.factor,maxAttempts:e.maxAttempts===void 0?3:e.maxAttempts,timeout:e.timeout===void 0?0:e.timeout,jitter:e.jitter===!0,initialJitter:e.initialJitter===!0,handleError:e.handleError===void 0?null:e.handleError,handleTimeout:e.handleTimeout===void 0?null:e.handleTimeout,beforeAttempt:e.beforeAttempt===void 0?null:e.beforeAttempt,calculateDelay:e.calculateDelay===void 0?null:e.calculateDelay}}async function Br(e){return new Promise(t=>setTimeout(t,e))}function da(e,t){let n=t.delay;if(n===0)return 0;if(t.factor&&(n*=Math.pow(t.factor,e.attemptNum-1),t.maxDelay!==0&&(n=Math.min(n,t.maxDelay))),t.jitter){let r=Math.ceil(t.minDelay),s=Math.floor(n);n=Math.floor(Math.random()*(s-r+1))+r}return Math.round(n)}async function so(e,t){let n=ua(t);for(let c of["delay","initialDelay","minDelay","maxDelay","maxAttempts","timeout"]){let l=n[c];if(!Number.isInteger(l)||l<0)throw new Error(`Value for ${c} must be an integer greater than or equal to 0`)}if(n.factor.constructor!==Number||n.factor<0)throw new Error("Value for factor must be a number greater than or equal to 0");if(n.delay<n.minDelay)throw new Error(`delay cannot be less than minDelay (delay: ${n.delay}, minDelay: ${n.minDelay}`);let r={attemptNum:0,attemptsRemaining:n.maxAttempts?n.maxAttempts:-1,aborted:!1,abort(){r.aborted=!0}},s=n.calculateDelay||da;async function i(){if(n.beforeAttempt&&n.beforeAttempt(r,n),r.aborted){let l=new Error("Attempt aborted");throw l.code="ATTEMPT_ABORTED",l}let c=async l=>{if(n.handleError&&await n.handleError(l,r,n),r.aborted||r.attemptsRemaining===0)throw l;r.attemptNum++;let a=s(r,n);return a&&await Br(a),i()};return r.attemptsRemaining>0&&r.attemptsRemaining--,n.timeout?new Promise((l,a)=>{let h=setTimeout(()=>{if(n.handleTimeout)try{l(n.handleTimeout(r,n))}catch(u){a(u)}else{let u=new Error(`Retry timeout (attemptNum: ${r.attemptNum}, timeout: ${n.timeout})`);u.code="ATTEMPT_TIMEOUT",a(u)}},n.timeout);e(r,n).then(u=>{clearTimeout(h),l(u)}).catch(u=>{clearTimeout(h),c(u).then(l).catch(a)})}):e(r,n).catch(c)}let o=n.calculateDelay?n.calculateDelay(r,n):n.initialDelay;if(o&&await Br(o),r.attemptNum<1&&n.initialJitter){let c=s(r,n);c&&await Br(c)}return i()}var co=Math.floor,fa=(e,t)=>e<t?e:t,ga=(e,t)=>e>t?e:t,pa=64,On=128,ma=63,Pe=127,lo=Number.MAX_SAFE_INTEGER,wa=()=>new Set,ya=Array.from,ba=e=>{let t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},He=typeof TextEncoder!="undefined"?new TextEncoder:null,ka=e=>He.encode(e),Sa=He?ka:ba,Fe=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Fe&&Fe.decode(new Uint8Array).length===1&&(Fe=null);var jr=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},es=()=>new jr,ao=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},ns=e=>{let t=new Uint8Array(ao(e)),n=0;for(let r=0;r<e.bufs.length;r++){let s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},Vn=(e,t)=>{let n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},L=(e,t)=>{for(;t>Pe;)Vn(e,On|Pe&t),t=co(t/128);Vn(e,Pe&t)},Hr=new Uint8Array(3e4),xa=Hr.length/3,Ca=(e,t)=>{if(t.length<xa){let n=He.encodeInto(t,Hr).written||0;L(e,n);for(let r=0;r<n;r++)Vn(e,Hr[r])}else he(e,Sa(t))},Ua=(e,t)=>{let n=unescape(encodeURIComponent(t)),r=n.length;L(e,r);for(let s=0;s<r;s++)Vn(e,n.codePointAt(s))},dt=He&&He.encodeInto?Ca:Ua,Aa=(e,t)=>{let n=e.cbuf.length,r=e.cpos,s=fa(n-r,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(ga(n*2,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},he=(e,t)=>{L(e,t.byteLength),Aa(e,t)},ho=e=>new Error(e),uo=ho("Unexpected end of array"),fo=ho("Integer out of Range"),zr=class{constructor(t){this.arr=t,this.pos=0}},go=e=>new zr(e),_a=(e,t)=>{let n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Bn=e=>_a(e,Ht(e)),io=e=>e.arr[e.pos++],Ht=e=>{let t=0,n=1,r=e.arr.length;for(;e.pos<r;){let s=e.arr[e.pos++];if(t=t+(s&Pe)*n,n*=128,s<On)return t;if(t>lo)throw fo}throw uo},Ea=e=>{let t=e.arr[e.pos++],n=t&ma,r=64,s=(t&pa)>0?-1:1;if((t&On)===0)return s*n;let i=e.arr.length;for(;e.pos<i;){if(t=e.arr[e.pos++],n=n+(t&Pe)*r,r*=128,t<On)return s*n;if(n>lo)throw fo}throw uo},Da=e=>{let t=Ht(e);if(t===0)return"";{let n=String.fromCodePoint(io(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(io(e));else for(;t>0;){let r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},Ia=e=>Fe.decode(Bn(e)),ze=Fe?Ia:Da,Ta=e=>{let t=e.pos,n=ze(e);return e.pos=t,n},ae=Date.now,Pr=()=>new Map,va=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},$r=class{constructor(){this._observers=Pr()}on(t,n){va(this._observers,t,wa).add(n)}once(t,n){let r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){let r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return ya((this._observers.get(t)||Pr()).values()).forEach(r=>r(...n))}destroy(){this._observers=Pr()}},Oa=Object.keys,oo=e=>Oa(e).length,Va=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),La=(e,t)=>e===t,je=(e,t)=>{if(e==null||t==null)return La(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(let n of e.keys())if(!t.has(n)||!je(e.get(n),t.get(n)))return!1;break}case Object:if(oo(e)!==oo(t))return!1;for(let n in e)if(!Va(e,n)||!je(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!je(e[n],t[n]))return!1;break;default:return!1}return!0},Fr=3e4,Gr=class extends $r{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let n=ae();this.getLocalState()!==null&&Fr/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((s,i)=>{i!==this.clientID&&Fr<=n-s.lastUpdated&&this.states.has(i)&&r.push(i)}),r.length>0&&vn(this,r,"timeout")},co(Fr/10)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){let n=this.clientID,r=this.meta.get(n),s=r===void 0?0:r.clock+1,i=this.states.get(n);t===null?this.states.delete(n):this.states.set(n,t),this.meta.set(n,{clock:s,lastUpdated:ae()});let o=[],c=[],l=[],a=[];t===null?a.push(n):i==null?t!=null&&o.push(n):(c.push(n),je(i,t)||l.push(n)),(o.length>0||l.length>0||a.length>0)&&this.emit("change",[{added:o,updated:l,removed:a},"local"]),this.emit("update",[{added:o,updated:c,removed:a},"local"])}setLocalStateField(t,n){let r=this.getLocalState();r!==null&&this.setLocalState(ue(W({},r),{[t]:n}))}getStates(){return this.states}},vn=(e,t,n)=>{let r=[];for(let s=0;s<t.length;s++){let i=t[s];if(e.states.has(i)){if(e.states.delete(i),i===e.clientID){let o=e.meta.get(i);e.meta.set(i,{clock:o.clock+1,lastUpdated:ae()})}r.push(i)}}r.length>0&&(e.emit("change",[{added:[],updated:[],removed:r},n]),e.emit("update",[{added:[],updated:[],removed:r},n]))},qr=(e,t,n=e.states)=>{let r=t.length,s=es();L(s,r);for(let i=0;i<r;i++){let o=t[i],c=n.get(o)||null,l=e.meta.get(o).clock;L(s,o),L(s,l),dt(s,JSON.stringify(c))}return ns(s)},Na=(e,t,n)=>{let r=go(t),s=ae(),i=[],o=[],c=[],l=[],a=Ht(r);for(let h=0;h<a;h++){let u=Ht(r),d=Ht(r),f=JSON.parse(ze(r)),g=e.meta.get(u),b=e.states.get(u),p=g===void 0?0:g.clock;(p<d||p===d&&f===null&&e.states.has(u))&&(f===null?u===e.clientID&&e.getLocalState()!=null?d++:e.states.delete(u):e.states.set(u,f),e.meta.set(u,{clock:d,lastUpdated:s}),g===void 0&&f!==null?i.push(u):g!==void 0&&f===null?l.push(u):f!==null&&(je(f,b)||c.push(u),o.push(u)))}(i.length>0||c.length>0||l.length>0)&&e.emit("change",[{added:i,updated:c,removed:l},n]),(i.length>0||o.length>0||l.length>0)&&e.emit("update",[{added:i,updated:o,removed:l},n])},Ln=class{constructor(){this.callbacks={}}on(t,n){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(n),this}emit(t,...n){let r=this.callbacks[t];return r&&r.forEach(s=>s.apply(this,n)),this}off(t,n){let r=this.callbacks[t];return r&&(n?this.callbacks[t]=r.filter(s=>s!==n):delete this.callbacks[t]),this}removeAllListeners(){this.callbacks={}}},$e=class{constructor(t){this.data=t,this.encoder=es(),this.decoder=go(new Uint8Array(this.data))}peekVarString(){return Ta(this.decoder)}readVarUint(){return Ht(this.decoder)}readVarString(){return ze(this.decoder)}readVarUint8Array(){return Bn(this.decoder)}writeVarUint(t){return L(this.encoder,t)}writeVarString(t){return dt(this.encoder,t)}writeVarUint8Array(t){return he(this.encoder,t)}length(){return ao(this.encoder)}},v;(function(e){e[e.Sync=0]="Sync",e[e.Awareness=1]="Awareness",e[e.Auth=2]="Auth",e[e.QueryAwareness=3]="QueryAwareness",e[e.Stateless=5]="Stateless",e[e.CLOSE=7]="CLOSE",e[e.SyncStatus=8]="SyncStatus"})(v||(v={}));var B;(function(e){e.Connecting="connecting",e.Connected="connected",e.Disconnected="disconnected"})(B||(B={}));var ft=class{constructor(){this.encoder=es()}get(t){return t.encoder}toUint8Array(){return ns(this.encoder)}},Jr=class extends ft{constructor(){super(...arguments),this.type=v.CLOSE,this.description="Ask the server to close the connection"}get(t){return dt(this.encoder,t.documentName),L(this.encoder,this.type),this.encoder}},Yr=class extends Ln{constructor(t){super(),this.messageQueue=[],this.configuration={url:"",autoConnect:!0,document:void 0,WebSocketPolyfill:void 0,messageReconnectTimeout:3e4,delay:1e3,initialDelay:0,factor:2,maxAttempts:0,minDelay:1e3,maxDelay:3e4,jitter:!0,timeout:0,onOpen:()=>null,onConnect:()=>null,onMessage:()=>null,onOutgoingMessage:()=>null,onStatus:()=>null,onDisconnect:()=>null,onClose:()=>null,onDestroy:()=>null,onAwarenessUpdate:()=>null,onAwarenessChange:()=>null,handleTimeout:null,providerMap:new Map},this.webSocket=null,this.webSocketHandlers={},this.shouldConnect=!0,this.status=B.Disconnected,this.lastMessageReceived=0,this.identifier=0,this.intervals={connectionChecker:null},this.connectionAttempt=null,this.receivedOnOpenPayload=void 0,this.closeTries=0,this.setConfiguration(t),this.configuration.WebSocketPolyfill=t.WebSocketPolyfill?t.WebSocketPolyfill:WebSocket,this.on("open",this.configuration.onOpen),this.on("open",this.onOpen.bind(this)),this.on("connect",this.configuration.onConnect),this.on("message",this.configuration.onMessage),this.on("outgoingMessage",this.configuration.onOutgoingMessage),this.on("status",this.configuration.onStatus),this.on("disconnect",this.configuration.onDisconnect),this.on("close",this.configuration.onClose),this.on("destroy",this.configuration.onDestroy),this.on("awarenessUpdate",this.configuration.onAwarenessUpdate),this.on("awarenessChange",this.configuration.onAwarenessChange),this.on("close",this.onClose.bind(this)),this.on("message",this.onMessage.bind(this)),this.intervals.connectionChecker=setInterval(this.checkConnection.bind(this),this.configuration.messageReconnectTimeout/10),this.shouldConnect&&this.connect()}async onOpen(t){this.status=B.Connected,this.emit("status",{status:B.Connected}),this.cancelWebsocketRetry=void 0,this.receivedOnOpenPayload=t}attach(t){this.configuration.providerMap.set(t.configuration.name,t),this.status===B.Disconnected&&this.shouldConnect&&this.connect(),this.receivedOnOpenPayload&&this.status===B.Connected&&t.onOpen(this.receivedOnOpenPayload)}detach(t){this.configuration.providerMap.has(t.configuration.name)&&(t.send(Jr,{documentName:t.configuration.name}),this.configuration.providerMap.delete(t.configuration.name))}setConfiguration(t={}){this.configuration=W(W({},this.configuration),t),this.configuration.autoConnect||(this.shouldConnect=!1)}async connect(){if(this.status===B.Connected)return;this.cancelWebsocketRetry&&(this.cancelWebsocketRetry(),this.cancelWebsocketRetry=void 0),this.receivedOnOpenPayload=void 0,this.shouldConnect=!0;let t=()=>{let s=!1;return{retryPromise:so(this.createWebSocketConnection.bind(this),{delay:this.configuration.delay,initialDelay:this.configuration.initialDelay,factor:this.configuration.factor,maxAttempts:this.configuration.maxAttempts,minDelay:this.configuration.minDelay,maxDelay:this.configuration.maxDelay,jitter:this.configuration.jitter,timeout:this.configuration.timeout,handleTimeout:this.configuration.handleTimeout,beforeAttempt:o=>{(!this.shouldConnect||s)&&o.abort()}}).catch(o=>{if(o&&o.code!=="ATTEMPT_ABORTED")throw o}),cancelFunc:()=>{s=!0}}},{retryPromise:n,cancelFunc:r}=t();return this.cancelWebsocketRetry=r,n}attachWebSocketListeners(t,n){let{identifier:r}=t,s=a=>this.emit("message",a),i=a=>this.emit("close",{event:a}),o=a=>this.emit("open",a),c=a=>{n(a)};this.webSocketHandlers[r]={message:s,close:i,open:o,error:c};let l=this.webSocketHandlers[t.identifier];Object.keys(l).forEach(a=>{t.addEventListener(a,l[a])})}cleanupWebSocket(){if(!this.webSocket)return;let{identifier:t}=this.webSocket,n=this.webSocketHandlers[t];Object.keys(n).forEach(r=>{var s;(s=this.webSocket)===null||s===void 0||s.removeEventListener(r,n[r]),delete this.webSocketHandlers[t]}),this.webSocket.close(),this.webSocket=null}createWebSocketConnection(){return new Promise((t,n)=>{this.webSocket&&(this.messageQueue=[],this.cleanupWebSocket()),this.lastMessageReceived=0,this.identifier+=1;let r=new this.configuration.WebSocketPolyfill(this.url);r.binaryType="arraybuffer",r.identifier=this.identifier,this.attachWebSocketListeners(r,n),this.webSocket=r,this.status=B.Connecting,this.emit("status",{status:B.Connecting}),this.connectionAttempt={resolve:t,reject:n}})}onMessage(t){var n;this.resolveConnectionAttempt(),this.lastMessageReceived=ae();let s=new $e(t.data).peekVarString();(n=this.configuration.providerMap.get(s))===null||n===void 0||n.onMessage(t)}resolveConnectionAttempt(){this.connectionAttempt&&(this.connectionAttempt.resolve(),this.connectionAttempt=null,this.status=B.Connected,this.emit("status",{status:B.Connected}),this.emit("connect"),this.messageQueue.forEach(t=>this.send(t)),this.messageQueue=[])}stopConnectionAttempt(){this.connectionAttempt=null}rejectConnectionAttempt(){var t;(t=this.connectionAttempt)===null||t===void 0||t.reject(),this.connectionAttempt=null}checkConnection(){var t;this.status===B.Connected&&this.lastMessageReceived&&(this.configuration.messageReconnectTimeout>=ae()-this.lastMessageReceived||(this.closeTries+=1,this.closeTries>2?(this.onClose({event:{code:4408,reason:"forced"}}),this.closeTries=0):((t=this.webSocket)===null||t===void 0||t.close(),this.messageQueue=[])))}get serverUrl(){for(;this.configuration.url[this.configuration.url.length-1]==="/";)return this.configuration.url.slice(0,this.configuration.url.length-1);return this.configuration.url}get url(){return this.serverUrl}disconnect(){if(this.shouldConnect=!1,this.webSocket!==null)try{this.webSocket.close(),this.messageQueue=[]}catch(t){console.error(t)}}send(t){var n;((n=this.webSocket)===null||n===void 0?void 0:n.readyState)===In.Open?this.webSocket.send(t):this.messageQueue.push(t)}onClose({event:t}){this.closeTries=0,this.cleanupWebSocket(),this.connectionAttempt&&this.rejectConnectionAttempt(),this.status=B.Disconnected,this.emit("status",{status:B.Disconnected}),this.emit("disconnect",{event:t}),!this.cancelWebsocketRetry&&this.shouldConnect&&setTimeout(()=>{this.connect()},this.configuration.delay)}destroy(){this.emit("destroy"),clearInterval(this.intervals.connectionChecker),this.stopConnectionAttempt(),this.disconnect(),this.removeAllListeners(),this.cleanupWebSocket()}},po=0,rs=1,mo=2,Ma=(e,t)=>{L(e,po);let n=_r(t);he(e,n)},Ra=(e,t,n)=>{L(e,rs),he(e,Cr(t,n))},Ba=(e,t,n)=>Ra(t,n,Bn(e)),wo=(e,t,n)=>{try{xr(t,Bn(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Pa=(e,t)=>{L(e,mo),he(e,t)},Fa=wo,ja=(e,t,n,r)=>{let s=Ht(e);switch(s){case po:Ba(e,t,n);break;case rs:wo(e,n,r);break;case mo:Fa(e,n,r);break;default:throw new Error("Unknown message type")}return s},Wr=class{constructor(t){this.message=t}apply(t,n){let{message:r}=this,s=r.readVarUint(),i=r.length();switch(s){case v.Sync:this.applySyncMessage(t,n);break;case v.Awareness:this.applyAwarenessMessage(t);break;case v.Auth:this.applyAuthMessage(t);break;case v.QueryAwareness:this.applyQueryAwarenessMessage(t);break;case v.Stateless:t.receiveStateless(ze(r.decoder));break;case v.SyncStatus:this.applySyncStatusMessage(t,Ea(r.decoder)===1);break;case v.CLOSE:let o={code:1e3,reason:ze(r.decoder),target:t.configuration.websocketProvider.webSocket,type:"close"};t.onClose(),t.configuration.onClose({event:o}),t.forwardClose(o);break;default:throw new Error(`Can\u2019t apply message of unknown type: ${s}`)}r.length()>i+1&&t.send(ft,{encoder:r.encoder})}applySyncMessage(t,n){let{message:r}=this;r.writeVarUint(v.Sync);let s=ja(r.decoder,r.encoder,t.document,t);n&&s===rs&&(t.synced=!0)}applySyncStatusMessage(t,n){n&&t.decrementUnsyncedChanges()}applyAwarenessMessage(t){if(!t.awareness)return;let{message:n}=this;Na(t.awareness,n.readVarUint8Array(),t)}applyAuthMessage(t){let{message:n}=this;ro(n.decoder,t.sendToken.bind(t),t.permissionDeniedHandler.bind(t),t.authenticatedHandler.bind(t))}applyQueryAwarenessMessage(t){if(!t.awareness)return;let{message:n}=this;n.writeVarUint(v.Awareness),n.writeVarUint8Array(qr(t.awareness,Array.from(t.awareness.getStates().keys())))}},Xr=class{constructor(t,n={}){this.message=new t,this.encoder=this.message.get(n)}create(){return ns(this.encoder)}send(t){t==null||t.send(this.create())}},Kr=class extends ft{constructor(){super(...arguments),this.type=v.Auth,this.description="Authentication"}get(t){if(typeof t.token=="undefined")throw new Error("The authentication message requires `token` as an argument.");return dt(this.encoder,t.documentName),L(this.encoder,this.type),no(this.encoder,t.token),this.encoder}},Nn=class extends ft{constructor(){super(...arguments),this.type=v.Awareness,this.description="Awareness states update"}get(t){if(typeof t.awareness=="undefined")throw new Error("The awareness message requires awareness as an argument");if(typeof t.clients=="undefined")throw new Error("The awareness message requires clients as an argument");dt(this.encoder,t.documentName),L(this.encoder,this.type);let n;return t.states===void 0?n=qr(t.awareness,t.clients):n=qr(t.awareness,t.clients,t.states),he(this.encoder,n),this.encoder}},Qr=class extends ft{constructor(){super(...arguments),this.type=v.Stateless,this.description="A stateless message"}get(t){var n;return dt(this.encoder,t.documentName),L(this.encoder,this.type),dt(this.encoder,(n=t.payload)!==null&&n!==void 0?n:""),this.encoder}},Mn=class extends ft{constructor(){super(...arguments),this.type=v.Sync,this.description="First sync step"}get(t){if(typeof t.document=="undefined")throw new Error("The sync step one message requires document as an argument");return dt(this.encoder,t.documentName),L(this.encoder,this.type),Ma(this.encoder,t.document),this.encoder}},Zr=class extends ft{constructor(){super(...arguments),this.type=v.Sync,this.description="A document update"}get(t){return dt(this.encoder,t.documentName),L(this.encoder,this.type),Pa(this.encoder,t.update),this.encoder}},ts=class extends Error{constructor(){super(...arguments),this.code=1001}},Rn=class extends Ln{constructor(t){var n,r,s;super(),this.configuration={name:"",document:void 0,awareness:void 0,token:null,forceSyncInterval:!1,onAuthenticated:()=>null,onAuthenticationFailed:()=>null,onOpen:()=>null,onConnect:()=>null,onMessage:()=>null,onOutgoingMessage:()=>null,onSynced:()=>null,onStatus:()=>null,onDisconnect:()=>null,onClose:()=>null,onDestroy:()=>null,onAwarenessUpdate:()=>null,onAwarenessChange:()=>null,onStateless:()=>null,onUnsyncedChanges:()=>null},this.isSynced=!1,this.unsyncedChanges=0,this.isAuthenticated=!1,this.authorizedScope=void 0,this.manageSocket=!1,this._isAttached=!1,this.intervals={forceSync:null},this.boundDocumentUpdateHandler=this.documentUpdateHandler.bind(this),this.boundAwarenessUpdateHandler=this.awarenessUpdateHandler.bind(this),this.boundPageHide=this.pageHide.bind(this),this.boundOnOpen=this.onOpen.bind(this),this.boundOnClose=this.onClose.bind(this),this.forwardConnect=()=>this.emit("connect"),this.forwardStatus=i=>this.emit("status",i),this.forwardClose=i=>this.emit("close",i),this.forwardDisconnect=i=>this.emit("disconnect",i),this.forwardDestroy=()=>this.emit("destroy"),this.setConfiguration(t),this.configuration.document=t.document?t.document:new st,this.configuration.awareness=t.awareness!==void 0?t.awareness:new Gr(this.document),this.on("open",this.configuration.onOpen),this.on("message",this.configuration.onMessage),this.on("outgoingMessage",this.configuration.onOutgoingMessage),this.on("synced",this.configuration.onSynced),this.on("destroy",this.configuration.onDestroy),this.on("awarenessUpdate",this.configuration.onAwarenessUpdate),this.on("awarenessChange",this.configuration.onAwarenessChange),this.on("stateless",this.configuration.onStateless),this.on("unsyncedChanges",this.configuration.onUnsyncedChanges),this.on("authenticated",this.configuration.onAuthenticated),this.on("authenticationFailed",this.configuration.onAuthenticationFailed),(n=this.awareness)===null||n===void 0||n.on("update",()=>{this.emit("awarenessUpdate",{states:Rr(this.awareness.getStates())})}),(r=this.awareness)===null||r===void 0||r.on("change",()=>{this.emit("awarenessChange",{states:Rr(this.awareness.getStates())})}),this.document.on("update",this.boundDocumentUpdateHandler),(s=this.awareness)===null||s===void 0||s.on("update",this.boundAwarenessUpdateHandler),this.registerEventListeners(),this.configuration.forceSyncInterval&&typeof this.configuration.forceSyncInterval=="number"&&(this.intervals.forceSync=setInterval(this.forceSync.bind(this),this.configuration.forceSyncInterval)),this.manageSocket&&this.attach()}setConfiguration(t={}){if(!t.websocketProvider){let n=t;this.manageSocket=!0,this.configuration.websocketProvider=new Yr({url:n.url})}this.configuration=W(W({},this.configuration),t)}get document(){return this.configuration.document}get isAttached(){return this._isAttached}get awareness(){return this.configuration.awareness}get hasUnsyncedChanges(){return this.unsyncedChanges>0}resetUnsyncedChanges(){this.unsyncedChanges=1,this.emit("unsyncedChanges",{number:this.unsyncedChanges})}incrementUnsyncedChanges(){this.unsyncedChanges+=1,this.emit("unsyncedChanges",{number:this.unsyncedChanges})}decrementUnsyncedChanges(){this.unsyncedChanges>0&&(this.unsyncedChanges-=1),this.unsyncedChanges===0&&(this.synced=!0),this.emit("unsyncedChanges",{number:this.unsyncedChanges})}forceSync(){this.resetUnsyncedChanges(),this.send(Mn,{document:this.document,documentName:this.configuration.name})}pageHide(){this.awareness&&vn(this.awareness,[this.document.clientID],"page hide")}registerEventListeners(){typeof window=="undefined"||!("addEventListener"in window)||window.addEventListener("pagehide",this.boundPageHide)}sendStateless(t){this.send(Qr,{documentName:this.configuration.name,payload:t})}async sendToken(){let t;try{t=await this.getToken()}catch(n){this.permissionDeniedHandler(`Failed to get token during sendToken(): ${n}`);return}this.send(Kr,{token:t!=null?t:"",documentName:this.configuration.name})}documentUpdateHandler(t,n){n!==this&&(this.incrementUnsyncedChanges(),this.send(Zr,{update:t,documentName:this.configuration.name}))}awarenessUpdateHandler({added:t,updated:n,removed:r},s){let i=t.concat(n).concat(r);this.send(Nn,{awareness:this.awareness,clients:i,documentName:this.configuration.name})}get synced(){return this.isSynced}set synced(t){this.isSynced!==t&&(this.isSynced=t,t&&this.emit("synced",{state:t}))}receiveStateless(t){this.emit("stateless",{payload:t})}async connect(){if(this.manageSocket)return this.configuration.websocketProvider.connect();console.warn("HocuspocusProvider::connect() is deprecated and does not do anything. Please connect/disconnect on the websocketProvider, or attach/deattach providers.")}disconnect(){if(this.manageSocket)return this.configuration.websocketProvider.disconnect();console.warn("HocuspocusProvider::disconnect() is deprecated and does not do anything. Please connect/disconnect on the websocketProvider, or attach/deattach providers.")}async onOpen(t){this.isAuthenticated=!1,this.emit("open",{event:t}),await this.sendToken(),this.startSync()}async getToken(){return typeof this.configuration.token=="function"?await this.configuration.token():this.configuration.token}startSync(){this.resetUnsyncedChanges(),this.send(Mn,{document:this.document,documentName:this.configuration.name}),this.awareness&&this.awareness.getLocalState()!==null&&this.send(Nn,{awareness:this.awareness,clients:[this.document.clientID],documentName:this.configuration.name})}send(t,n){if(!this._isAttached)return;let r=new Xr(t,n);this.emit("outgoingMessage",{message:r.message}),r.send(this.configuration.websocketProvider)}onMessage(t){let n=new $e(t.data),r=n.readVarString();n.writeVarString(r),this.emit("message",{event:t,message:new $e(t.data)}),new Wr(n).apply(this,!0)}onClose(){this.isAuthenticated=!1,this.synced=!1,this.awareness&&vn(this.awareness,Array.from(this.awareness.getStates().keys()).filter(t=>t!==this.document.clientID),this)}destroy(){this.emit("destroy"),this.intervals.forceSync&&clearInterval(this.intervals.forceSync),this.awareness&&(vn(this.awareness,[this.document.clientID],"provider destroy"),this.awareness.off("update",this.boundAwarenessUpdateHandler),this.awareness.destroy()),this.document.off("update",this.boundDocumentUpdateHandler),this.removeAllListeners(),this.detach(),this.manageSocket&&this.configuration.websocketProvider.destroy(),!(typeof window=="undefined"||!("removeEventListener"in window))&&window.removeEventListener("pagehide",this.boundPageHide)}detach(){this.configuration.websocketProvider.off("connect",this.configuration.onConnect),this.configuration.websocketProvider.off("connect",this.forwardConnect),this.configuration.websocketProvider.off("status",this.forwardStatus),this.configuration.websocketProvider.off("status",this.configuration.onStatus),this.configuration.websocketProvider.off("open",this.boundOnOpen),this.configuration.websocketProvider.off("close",this.boundOnClose),this.configuration.websocketProvider.off("close",this.configuration.onClose),this.configuration.websocketProvider.off("close",this.forwardClose),this.configuration.websocketProvider.off("disconnect",this.configuration.onDisconnect),this.configuration.websocketProvider.off("disconnect",this.forwardDisconnect),this.configuration.websocketProvider.off("destroy",this.configuration.onDestroy),this.configuration.websocketProvider.off("destroy",this.forwardDestroy),this.configuration.websocketProvider.detach(this),this._isAttached=!1}attach(){this._isAttached||(this.configuration.websocketProvider.on("connect",this.configuration.onConnect),this.configuration.websocketProvider.on("connect",this.forwardConnect),this.configuration.websocketProvider.on("status",this.configuration.onStatus),this.configuration.websocketProvider.on("status",this.forwardStatus),this.configuration.websocketProvider.on("open",this.boundOnOpen),this.configuration.websocketProvider.on("close",this.boundOnClose),this.configuration.websocketProvider.on("close",this.configuration.onClose),this.configuration.websocketProvider.on("close",this.forwardClose),this.configuration.websocketProvider.on("disconnect",this.configuration.onDisconnect),this.configuration.websocketProvider.on("disconnect",this.forwardDisconnect),this.configuration.websocketProvider.on("destroy",this.configuration.onDestroy),this.configuration.websocketProvider.on("destroy",this.forwardDestroy),this.configuration.websocketProvider.attach(this),this._isAttached=!0)}permissionDeniedHandler(t){this.emit("authenticationFailed",{reason:t}),this.isAuthenticated=!1}authenticatedHandler(t){this.isAuthenticated=!0,this.authorizedScope=t,this.emit("authenticated",{scope:t})}setAwarenessField(t,n){if(!this.awareness)throw new ts(`Cannot set awareness field "${t}" to ${JSON.stringify(n)}. You have disabled Awareness for this provider by explicitly passing awareness: null in the provider configuration.`);this.awareness.setLocalStateField(t,n)}};window.Y=_n;window.HocuspocusProvider=Rn;console.log("[Yjs Deps] Bundled dependencies loaded");})();
